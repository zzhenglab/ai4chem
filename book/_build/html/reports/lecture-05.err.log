Traceback (most recent call last):
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\jupyter_core\utils\__init__.py", line 154, in wrapped
    asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\jupyter_cache\executors\utils.py", line 58, in single_nb_execution
    executenb(
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\nbclient\client.py", line 1305, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\jupyter_core\utils\__init__.py", line 158, in wrapped
    return loop.run_until_complete(inner)
  File "c:\users\52377\appdata\local\programs\python\python38\lib\asyncio\base_events.py", line 616, in run_until_complete
    return future.result()
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\nbclient\client.py", line 705, in async_execute
    await self.async_execute_cell(
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\nbclient\client.py", line 1058, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\nbclient\client.py", line 914, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
# y_true as 1D binary
y_true = np.asarray(y_test)
y_true = np.argmax(y_true, axis=1)
y_true = y_true.astype(int)

# positive class scores
y_scores = np.asarray(y_proba)
if y_scores.ndim == 2:
    y_scores = y_scores[:, 1]

ths = np.arange(0.20, 0.81, 0.05)
rec_list, prec_list, f1_list = [], [], []
best_t = None
best_idx = None

i = 0
for t in ths:
    pred = (y_scores >= t).astype(int)
    r = recall_score(y_true, pred, zero_division=0)
    p = precision_score(y_true, pred, zero_division=0)
    f = f1_score(y_true, pred, zero_division=0)
    rec_list.append(r)
    prec_list.append(p)
    f1_list.append(f)
    if best_t is None and r >= 0.80:
        best_t = t
        best_idx = i
    i = i + 1

print("First threshold with recall >= 0.80:", best_t)
if best_t is not None:
    print("Precision at", best_t, ":", prec_list[best_idx])
    print("F1 at", best_t, ":", f1_list[best_idx])

plt.figure(figsize=(7,5))
plt.plot(ths, rec_list, "o-", label="Recall")
plt.plot(ths, prec_list, "o-", label="Precision")
plt.plot(ths, f1_list, "o-", label="F1")
plt.xlabel("Threshold")
plt.ylabel("Score")
plt.title("Threshold tuning on toxicity")
plt.legend()
plt.grid(True)
plt.show()
------------------


[1;31m---------------------------------------------------------------------------[0m
[1;31mAxisError[0m                                 Traceback (most recent call last)
Cell [1;32mIn[30], line 3[0m
[0;32m      1[0m [38;5;66;03m# y_true as 1D binary[39;00m
[0;32m      2[0m y_true [38;5;241m=[39m np[38;5;241m.[39masarray(y_test)
[1;32m----> 3[0m y_true [38;5;241m=[39m [43mnp[49m[38;5;241;43m.[39;49m[43margmax[49m[43m([49m[43my_true[49m[43m,[49m[43m [49m[43maxis[49m[38;5;241;43m=[39;49m[38;5;241;43m1[39;49m[43m)[49m
[0;32m      4[0m y_true [38;5;241m=[39m y_true[38;5;241m.[39mastype([38;5;28mint[39m)
[0;32m      6[0m [38;5;66;03m# positive class scores[39;00m

File [1;32m<__array_function__ internals>:200[0m, in [0;36margmax[1;34m(*args, **kwargs)[0m

File [1;32mc:\users\52377\appdata\local\programs\python\python38\lib\site-packages\numpy\core\fromnumeric.py:1242[0m, in [0;36margmax[1;34m(a, axis, out, keepdims)[0m
[0;32m   1155[0m [38;5;250m[39m[38;5;124;03m"""[39;00m
[0;32m   1156[0m [38;5;124;03mReturns the indices of the maximum values along an axis.[39;00m
[0;32m   1157[0m 
[1;32m   (...)[0m
[0;32m   1239[0m [38;5;124;03m(2, 1, 4)[39;00m
[0;32m   1240[0m [38;5;124;03m"""[39;00m
[0;32m   1241[0m kwds [38;5;241m=[39m {[38;5;124m'[39m[38;5;124mkeepdims[39m[38;5;124m'[39m: keepdims} [38;5;28;01mif[39;00m keepdims [38;5;129;01mis[39;00m [38;5;129;01mnot[39;00m np[38;5;241m.[39m_NoValue [38;5;28;01melse[39;00m {}
[1;32m-> 1242[0m [38;5;28;01mreturn[39;00m [43m_wrapfunc[49m[43m([49m[43ma[49m[43m,[49m[43m [49m[38;5;124;43m'[39;49m[38;5;124;43margmax[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[43maxis[49m[38;5;241;43m=[39;49m[43maxis[49m[43m,[49m[43m [49m[43mout[49m[38;5;241;43m=[39;49m[43mout[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwds[49m[43m)[49m

File [1;32mc:\users\52377\appdata\local\programs\python\python38\lib\site-packages\numpy\core\fromnumeric.py:57[0m, in [0;36m_wrapfunc[1;34m(obj, method, *args, **kwds)[0m
[0;32m     54[0m     [38;5;28;01mreturn[39;00m _wrapit(obj, method, [38;5;241m*[39margs, [38;5;241m*[39m[38;5;241m*[39mkwds)
[0;32m     56[0m [38;5;28;01mtry[39;00m:
[1;32m---> 57[0m     [38;5;28;01mreturn[39;00m [43mbound[49m[43m([49m[38;5;241;43m*[39;49m[43margs[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwds[49m[43m)[49m
[0;32m     58[0m [38;5;28;01mexcept[39;00m [38;5;167;01mTypeError[39;00m:
[0;32m     59[0m     [38;5;66;03m# A TypeError occurs if the object does have such a method in its[39;00m
[0;32m     60[0m     [38;5;66;03m# class, but its signature is not identical to that of NumPy's. This[39;00m
[1;32m   (...)[0m
[0;32m     64[0m     [38;5;66;03m# Call _wrapit from within the except clause to ensure a potential[39;00m
[0;32m     65[0m     [38;5;66;03m# exception has a traceback chain.[39;00m
[0;32m     66[0m     [38;5;28;01mreturn[39;00m _wrapit(obj, method, [38;5;241m*[39margs, [38;5;241m*[39m[38;5;241m*[39mkwds)

[1;31mAxisError[0m: axis 1 is out of bounds for array of dimension 1

