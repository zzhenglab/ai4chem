Traceback (most recent call last):
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\jupyter_core\utils\__init__.py", line 154, in wrapped
    asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\jupyter_cache\executors\utils.py", line 58, in single_nb_execution
    executenb(
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\nbclient\client.py", line 1305, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\jupyter_core\utils\__init__.py", line 158, in wrapped
    return loop.run_until_complete(inner)
  File "c:\users\52377\appdata\local\programs\python\python38\lib\asyncio\base_events.py", line 616, in run_until_complete
    return future.result()
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\nbclient\client.py", line 705, in async_execute
    await self.async_execute_cell(
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\nbclient\client.py", line 1058, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "c:\users\52377\appdata\local\programs\python\python38\lib\site-packages\nbclient\client.py", line 914, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
# Q1. t-SNE on 10 descriptors
from sklearn.preprocessing import StandardScaler
from sklearn.manifold import TSNE
from sklearn.cluster import KMeans, AgglomerativeClustering, DBSCAN
from sklearn.metrics import silhouette_score
from sklearn.metrics import pairwise_distances
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

# Assumes df_raw is already loaded and RDKit imports exist:
# from rdkit import Chem
# from rdkit.Chem import Descriptors, Crippen, rdMolDescriptors

def calc_descriptors10(smiles: str):
    m = Chem.MolFromSmiles(smiles)
    return pd.Series({
        "MolWt": Descriptors.MolWt(m),
        "LogP": Crippen.MolLogP(m),
        "TPSA": rdMolDescriptors.CalcTPSA(m),
        "NumRings": rdMolDescriptors.CalcNumRings(m),
        "NumHAcceptors": rdMolDescriptors.CalcNumHBA(m),
        "NumHDonors": rdMolDescriptors.CalcNumHBD(m),
        "NumRotatableBonds": rdMolDescriptors.CalcNumRotatableBonds(m),
        "HeavyAtomCount": Descriptors.HeavyAtomCount(m),
        "FractionCSP3": rdMolDescriptors.CalcFractionCSP3(m),
        "NumAromaticRings": rdMolDescriptors.CalcNumAromaticRings(m)
    })

# 10 descriptors
desc10 = df_raw["SMILES"].apply(calc_descriptors10)
df10 = pd.concat([df_raw.reset_index(drop=True), desc10.reset_index(drop=True)], axis=1)

cols10 = [
    "MolWt","LogP","TPSA","NumRings","NumHAcceptors",
    "NumHDonors","NumRotatableBonds","HeavyAtomCount",
    "FractionCSP3","NumAromaticRings"
]
scaler10 = StandardScaler().fit(df10[cols10])
X10 = scaler10.transform(df10[cols10])

# t-SNE embedding for descriptors (reused in Q4 and Q5)
tsne10 = TSNE(n_components=2, perplexity=30, learning_rate="auto",
              init="pca", metric="euclidean", random_state=0)
Z10 = tsne10.fit_transform(X10)

plt.figure(figsize=(5,4))
plt.scatter(Z10[:,0], Z10[:,1], s=12, alpha=0.85)
plt.xlabel("t-SNE 1"); plt.ylabel("t-SNE 2")
plt.title("t-SNE on 10 descriptors")
plt.tight_layout()
plt.show()

------------------


[1;31m---------------------------------------------------------------------------[0m
[1;31mNameError[0m                                 Traceback (most recent call last)
Cell [1;32mIn[1], line 31[0m
[0;32m     17[0m     [38;5;28;01mreturn[39;00m pd[38;5;241m.[39mSeries({
[0;32m     18[0m         [38;5;124m"[39m[38;5;124mMolWt[39m[38;5;124m"[39m: Descriptors[38;5;241m.[39mMolWt(m),
[0;32m     19[0m         [38;5;124m"[39m[38;5;124mLogP[39m[38;5;124m"[39m: Crippen[38;5;241m.[39mMolLogP(m),
[1;32m   (...)[0m
[0;32m     27[0m         [38;5;124m"[39m[38;5;124mNumAromaticRings[39m[38;5;124m"[39m: rdMolDescriptors[38;5;241m.[39mCalcNumAromaticRings(m)
[0;32m     28[0m     })
[0;32m     30[0m [38;5;66;03m# 10 descriptors[39;00m
[1;32m---> 31[0m desc10 [38;5;241m=[39m [43mdf_raw[49m[[38;5;124m"[39m[38;5;124mSMILES[39m[38;5;124m"[39m][38;5;241m.[39mapply(calc_descriptors10)
[0;32m     32[0m df10 [38;5;241m=[39m pd[38;5;241m.[39mconcat([df_raw[38;5;241m.[39mreset_index(drop[38;5;241m=[39m[38;5;28;01mTrue[39;00m), desc10[38;5;241m.[39mreset_index(drop[38;5;241m=[39m[38;5;28;01mTrue[39;00m)], axis[38;5;241m=[39m[38;5;241m1[39m)
[0;32m     34[0m cols10 [38;5;241m=[39m [
[0;32m     35[0m     [38;5;124m"[39m[38;5;124mMolWt[39m[38;5;124m"[39m,[38;5;124m"[39m[38;5;124mLogP[39m[38;5;124m"[39m,[38;5;124m"[39m[38;5;124mTPSA[39m[38;5;124m"[39m,[38;5;124m"[39m[38;5;124mNumRings[39m[38;5;124m"[39m,[38;5;124m"[39m[38;5;124mNumHAcceptors[39m[38;5;124m"[39m,
[0;32m     36[0m     [38;5;124m"[39m[38;5;124mNumHDonors[39m[38;5;124m"[39m,[38;5;124m"[39m[38;5;124mNumRotatableBonds[39m[38;5;124m"[39m,[38;5;124m"[39m[38;5;124mHeavyAtomCount[39m[38;5;124m"[39m,
[0;32m     37[0m     [38;5;124m"[39m[38;5;124mFractionCSP3[39m[38;5;124m"[39m,[38;5;124m"[39m[38;5;124mNumAromaticRings[39m[38;5;124m"[39m
[0;32m     38[0m ]

[1;31mNameError[0m: name 'df_raw' is not defined

