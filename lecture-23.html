
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lecture 23 - Prompt Engineering and Function Calling &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lecture-23';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Lecture 22 - Vision Languge Models" href="lecture-22.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to CHEM 5080: AI for Experimental Chemistry
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lecture-01.html">Lecture 1 - Python Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-02.html">Lecture 2 - Pandas and Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-03.html">Lecture 3 - SMILES and RDKit</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-04.html">Lecture 4 - Chemical Structure Identifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-05.html">Lecture 5 - Regression and Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-06.html">Lecture 6 - Cross-Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-07.html">Lecture 7 - Decision Trees and Random Forests</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-08.html">Lecture 8 - Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-09.html">Lecture 9 - Graph Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-10.html">Lecture 10 - Property &amp; Reaction Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-11.html">Lecture 11 - Dimension Reduction for Data Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-12.html">Lecture 12 - Self-Supervised Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-13.html">Lecture 13 - De Novo Molecule Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-14.html">Lecture 14 - Bayesian Optimization for Synthesis Conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-15.html">Lecture 15 - Multi-objective Bayesian Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-16.html">Lecture 16 - Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-17.html">Lecture 17 - PU Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-18.html">Lecture 18 - Contrastive Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-19.html">Lecture 19 - Transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-20.html">Lecture 20 - Large Language Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-21.html">Lecture 21 - Computer Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-22.html">Lecture 22 - Vision Languge Models</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lecture 23 - Prompt Engineering and Function Calling</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Flecture-23.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/lecture-23.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 23 - Prompt Engineering and Function Calling</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">1. Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#zero-shot-prompts-for-chemistry">2. Zero-shot prompts for chemistry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ask-for-a-single-value">2.1 Ask for a single value</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#request-a-list-with-structure">2.2 Request a list with structure</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#one-shot-and-few-shot-patterns">3. One-shot and few-shot patterns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-shot-name-to-smiles">3.1 One-shot: name to SMILES</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#few-shot-classify-short-safety-statements">3.2 Few-shot: classify short safety statements</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#function-calling-from-prompt-to-tools">5. Function calling: from prompt to tools</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tool-specs-for-an-llm">5.1 Tool specs for an LLM</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-function-specifications">5.2 Defining Function Specifications</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-on-grams-to-moles">5.3 Example on <code class="docutils literal notranslate"><span class="pre">grams_to_moles</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-on-rdkit-basic">5.4 Example on <code class="docutils literal notranslate"><span class="pre">rdkit_basic</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-on-pubchem-search">5.5 Example on PubChem search</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-multiple-tools-in-one-conversation">5.6 Using multiple tools in one conversation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-pre-trained-model-as-a-tool">5.7 Use a pre-trained model as a tool</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glossary">6. Glossary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lecture-23-prompt-engineering-and-function-calling">
<h1>Lecture 23 - Prompt Engineering and Function Calling<a class="headerlink" href="#lecture-23-prompt-engineering-and-function-calling" title="Link to this heading">#</a></h1>
<p><em>Important Note</em>:</p>
<p>Always verify model suggestions against trusted sources and follow laboratory safety rules. LLM responses are not a substitute for method validation, risk assessment, or supervisor approval.</p>
<section id="learning-goals">
<h2>Learning goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Explain zero-shot, one-shot, and few-shot prompting in a chemistry setting.</p></li>
<li><p>Use <strong>structured prompts</strong> and ask for <strong>JSON</strong> outputs for easier downstream processing.</p></li>
<li><p>Call <strong>tools</strong> from prompts via simple function calling, then combine results back into a model response.</p></li>
</ul>
<p><a class="reference external" href="https://colab.research.google.com/drive/18NZIvGg0hd0P5oOTwfQ61x9K3dS6qdU_?usp=sharing"><img alt="Colab" src="https://img.shields.io/badge/Open-Colab-orange" /></a></p>
<p>For this lecture 20, it is recommended to run everything in Colab.</p>
</section>
<section id="setup">
<h2>1. Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Intentional stop: ending execution here.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Intentional stop: ending execution here.&quot;</span><span class="p">)</span>

<span class="ne">RuntimeError</span>: Intentional stop: ending execution here.
</pre></div>
</div>
</div>
</div>
</section>
<section id="zero-shot-prompts-for-chemistry">
<h2>2. Zero-shot prompts for chemistry<a class="headerlink" href="#zero-shot-prompts-for-chemistry" title="Link to this heading">#</a></h2>
<p>As we learned in the previous lecture, <strong>zero-shot</strong> means we ask a question without giving examples. The model relies on general knowledge and the instructions in our prompt.</p>
<p>Just a recap on the concepts on LLMs we covered before:</p>
<ul class="simple">
<li><p>A modern model predicts the next token conditioned on previous tokens. A <code class="docutils literal notranslate"><span class="pre">token</span></code> is a unit of text similar to a word piece.</p></li>
<li><p>The model output depends on your <code class="docutils literal notranslate"><span class="pre">instructions</span></code>, the <code class="docutils literal notranslate"><span class="pre">examples</span></code> you include, and any <code class="docutils literal notranslate"><span class="pre">tools</span></code> you give it.</p></li>
<li><p>The <strong>temperature</strong> parameter controls randomness. Small values close to 0 are helpful for stable formats.</p></li>
<li><p>The <strong>max output tokens</strong> parameter bounds the length of the response. If you set it too low the model may truncate.</p></li>
</ul>
<p><strong>Rule of Thumb for Prompt Engineering</strong></p>
<p>When writing a zero-shot chemistry prompt, remember this simple rule of thumb:</p>
<ol class="arabic simple">
<li><p>Be explicit about what you want</p></li>
<li><p>Structured about how you want it</p></li>
<li><p>Chemical about why you want it</p></li>
</ol>
<p>That means:</p>
<p>Explicit: Clearly state the goal (e.g., “Compute molar concentration in mol/L”).</p>
<p>Structured: Specify the required output format, (e.g., JSON, table, short answer within 5 words)</p>
<p>Chemical: Include the relevant context so the model can apply chemistry reasoning rather than guessing.</p>
<p>Further reading: <em>J. Am. Chem. Soc.</em> 2023, 145, 32, 18048–18062</p>
<section id="ask-for-a-single-value">
<h3>2.1 Ask for a single value<a class="headerlink" href="#ask-for-a-single-value" title="Link to this heading">#</a></h3>
<p>Request: moles of ethanol in a volume at a given density. We also compute the reference answer in Python to compare later.</p>
<p>We will ask the model to answer with a JSON object. This format is easy to parse. Keep field names short and explicit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reference calculation in pure Python</span>
<span class="n">volume_ml</span> <span class="o">=</span> <span class="mf">50.0</span>
<span class="n">density_g_per_ml</span> <span class="o">=</span> <span class="mf">0.789</span>
<span class="n">mw_ethanol</span> <span class="o">=</span> <span class="mf">46.07</span>  <span class="c1"># g/mol</span>
<span class="n">mass_g</span> <span class="o">=</span> <span class="n">volume_ml</span> <span class="o">*</span> <span class="n">density_g_per_ml</span>
<span class="n">moles_ref</span> <span class="o">=</span> <span class="n">mass_g</span> <span class="o">/</span> <span class="n">mw_ethanol</span>
<span class="nb">print</span><span class="p">({</span><span class="s2">&quot;mass_g&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">mass_g</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="s2">&quot;moles&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">moles_ref</span><span class="p">,</span> <span class="mi">4</span><span class="p">)})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;mass_g&#39;: 39.45, &#39;moles&#39;: 0.8563}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zero-shot prompt - live call only if client is configured</span>
<span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate moles of ethanol in 50 mL.</span>
<span class="sd">    Use density 0.789 g/mL and MW 46.07 g/mol.</span>
<span class="sd">    At the end, you start with **Answer:** and</span>
<span class="sd">    Return JSON with keys mass_g and moles with 4 decimals.&quot;&quot;&quot;</span>
<span class="p">)</span>


<span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>To calculate the moles of ethanol in 50 mL, use the given density and molecular weight.

1. **Calculate the mass of ethanol:**
   \[
   \text{mass} = \text{volume} \times \text{density} = 50 \, \text{mL} \times 0.789 \, \text{g/mL} = 39.45 \, \text{g}
   \]

2. **Calculate the moles of ethanol:**
   \[
   \text{moles} = \frac{\text{mass}}{\text{molecular weight}} = \frac{39.45 \, \text{g}}{46.07 \, \text{g/mol}} \approx 0.8563 \, \text{mol}
   \]

**Answer:**

```json
{
  &quot;mass_g&quot;: 39.4500,
  &quot;moles&quot;: 0.8563
}
```
</pre></div>
</div>
</div>
</div>
<p>Why JSON for a single value? Even one number becomes easier to log, compare, and use in later steps if the format is stable. In a lab pipeline this reduces copy-paste errors.</p>
<p>Below is you see that if we suggest a <em>table</em> instead of JSON, sometimes it’s hard to collect the answers across different calls as the format may differ slightly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prompt_table</span> <span class="o">=</span> <span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate moles of ethanol in 50 mL.</span>
<span class="sd">    Use density 0.789 g/mL and MW 46.07 g/mol.</span>
<span class="sd">    At the end, you start with **Answer:** and</span>
<span class="sd">    Return a table containing mass_g and moles with 4 decimals.&quot;&quot;&quot;</span>
<span class="p">)</span>


<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
  <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">prompt_table</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Answer </span><span class="si">{</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Answer 1 
To calculate the moles of ethanol in 50 mL, follow these steps:

1. **Calculate the mass of ethanol:**

   \[
   \text{mass} = \text{volume} \times \text{density} = 50 \, \text{mL} \times 0.789 \, \text{g/mL} = 39.45 \, \text{g}
   \]

2. **Calculate the moles of ethanol:**

   \[
   \text{moles} = \frac{\text{mass}}{\text{molar mass}} = \frac{39.45 \, \text{g}}{46.07 \, \text{g/mol}} = 0.8564 \, \text{moles}
   \]

**Answer:**

| mass_g | moles  |
|--------|--------|
| 39.4500 | 0.8564 |




 Answer 2 
To calculate the moles of ethanol in 50 mL, follow these steps:

1. **Calculate the mass:**
   \[
   \text{mass} = \text{density} \times \text{volume} = 0.789 \, \text{g/mL} \times 50 \, \text{mL} = 39.45 \, \text{g}
   \]

2. **Calculate the moles:**
   \[
   \text{moles} = \frac{\text{mass}}{\text{molar mass}} = \frac{39.45 \, \text{g}}{46.07 \, \text{g/mol}} \approx 0.8563 \, \text{mol}
   \]

**Answer:**

| mass\_g | moles  |
|---------|--------|
| 39.4500 | 0.8563 |




 Answer 3 
To calculate the moles of ethanol in 50 mL, follow these steps:

1. **Calculate Mass from Volume:**

   \[
   \text{Mass} = \text{Density} \times \text{Volume} = 0.789 \, \text{g/mL} \times 50 \, \text{mL} = 39.45 \, \text{g}
   \]

2. **Calculate Moles from Mass:**

   \[
   \text{Moles} = \frac{\text{Mass}}{\text{Molar Mass}} = \frac{39.45 \, \text{g}}{46.07 \, \text{g/mol}} \approx 0.8564 \, \text{mol}
   \]

**Answer:**

| mass_g | moles  |
|--------|--------|
| 39.4500| 0.8564 |
</pre></div>
</div>
</div>
</div>
</section>
<section id="request-a-list-with-structure">
<h3>2.2 Request a list with structure<a class="headerlink" href="#request-a-list-with-structure" title="Link to this heading">#</a></h3>
<p>Chemists often want properties in a table. Ask for a list of small items and show the structure as a preview.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Give three physical properties of ethanol. &quot;</span>
    <span class="s2">&quot;Return a JSON list with objects having keys: name, value, unit, source.&quot;</span>
<span class="p">)</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>```json
[
    {
        &quot;name&quot;: &quot;Boiling Point&quot;,
        &quot;value&quot;: 78.37,
        &quot;unit&quot;: &quot;°C&quot;,
        &quot;source&quot;: &quot;NIST Chemistry WebBook&quot;
    },
    {
        &quot;name&quot;: &quot;Density&quot;,
        &quot;value&quot;: 0.789,
        &quot;unit&quot;: &quot;g/cm³&quot;,
        &quot;source&quot;: &quot;NIST Chemistry WebBook&quot;
    },
    {
        &quot;name&quot;: &quot;Molecular Weight&quot;,
        &quot;value&quot;: 46.07,
        &quot;unit&quot;: &quot;g/mol&quot;,
        &quot;source&quot;: &quot;NIST Chemistry WebBook&quot;
    }
]
```
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="one-shot-and-few-shot-patterns">
<h2>3. One-shot and few-shot patterns<a class="headerlink" href="#one-shot-and-few-shot-patterns" title="Link to this heading">#</a></h2>
<p><strong>One-shot</strong> gives a single example. <strong>Few-shot</strong> gives several. These examples define a template that the model mimics. We will parse a chemical name into <strong>SMILES</strong> and then classify short safety statements.</p>
<p>When giving examples keep them clear and compact. Do not load too many examples at once or the model may copy phrasing rather than follow the idea.</p>
<section id="one-shot-name-to-smiles">
<h3>3.1 One-shot: name to SMILES<a class="headerlink" href="#one-shot-name-to-smiles" title="Link to this heading">#</a></h3>
<p>We show one input-output pair, then request a different compound with the same output shape. If RDKit is available, we validate the SMILES by constructing a molecule.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_name</span> <span class="o">=</span> <span class="s2">&quot;aspirin&quot;</span>
<span class="n">example_smiles</span> <span class="o">=</span> <span class="s2">&quot;O=C(O)C1=CC=CC=C1OC(=O)C&quot;</span>  <span class="c1"># a common representation</span>
<span class="n">target_name</span> <span class="o">=</span> <span class="s2">&quot;paracetamol&quot;</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">example_smiles</span><span class="p">)</span>
<span class="n">Draw</span><span class="o">.</span><span class="n">MolToImage</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">example_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cc594491e1ad776fdeba06c176d1f4f4426c3a0a508a285d1d16ebf6aff31702.png" src="_images/cc594491e1ad776fdeba06c176d1f4f4426c3a0a508a285d1d16ebf6aff31702.png" />
</div>
</div>
<p>Below, instead of just asking model to produce a JSON or Table, we show it what an output should look like.</p>
<p><code class="docutils literal notranslate"><span class="pre">{{&quot;name&quot;:&quot;{aspirin}&quot;,&quot;smiles&quot;:&quot;{O=C(O)C1=CC=CC=C1OC(=O)C}&quot;}}</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oneshot_prompt</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">You convert chemical names to SMILES in JSON.</span>
<span class="s1">Example input: &quot;</span><span class="si">{aspirin}</span><span class="s1">&quot;</span>
<span class="s1">Example output: {{&quot;name&quot;:&quot;</span><span class="si">{aspirin}</span><span class="s1">&quot;,&quot;smiles&quot;:&quot;{O=C(O)C1=CC=CC=C1OC(=O)C}&quot;}}</span>
<span class="s1">Now convert: &quot;</span><span class="si">{paracetamol}</span><span class="s1">&quot;</span>
<span class="s1">Return JSON with fields name and smiles only.</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">oneshot_prompt</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{{&quot;name&quot;:&quot;{paracetamol}&quot;,&quot;smiles&quot;:&quot;{CC(=O)NC1=CC=C(C=C1)O}&quot;}}
</pre></div>
</div>
</div>
</div>
<p>You can also use f-block to replace the examples in the prompt</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_name</span> <span class="o">=</span> <span class="s2">&quot;(S)-lactic acid&quot;</span>
<span class="n">example_smiles</span> <span class="o">=</span> <span class="s2">&quot;C[C@H](O)C(=O)O&quot;</span>
<span class="n">target_name</span> <span class="o">=</span> <span class="s2">&quot;L-alanine&quot;</span>


<span class="n">oneshot_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">You convert chemical names to SMILES in JSON.</span>
<span class="s1">Example input: &quot;</span><span class="si">{</span><span class="n">example_name</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">Example output: </span><span class="se">{{</span><span class="s1">&quot;name&quot;:&quot;</span><span class="si">{</span><span class="n">example_name</span><span class="si">}</span><span class="s1">&quot;,&quot;smiles&quot;:&quot;</span><span class="si">{</span><span class="n">example_smiles</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">}}</span>
<span class="s1">Now convert: &quot;</span><span class="si">{</span><span class="n">target_name</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">Return JSON with fields name and smiles only.</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">oneshot_prompt</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&quot;name&quot;:&quot;L-alanine&quot;,&quot;smiles&quot;:&quot;C[C@H](N)C(=O)O&quot;}
</pre></div>
</div>
</div>
</div>
<p>Again, note that LLM can halluciate! Always verify the answer produced.</p>
</section>
<section id="few-shot-classify-short-safety-statements">
<h3>3.2 Few-shot: classify short safety statements<a class="headerlink" href="#few-shot-classify-short-safety-statements" title="Link to this heading">#</a></h3>
<p>As you see below, we we do <em>few-shot</em>, we show possible inputs and the respective label outputs.</p>
<p>Few-shot design depends on the <strong>selection</strong> and <strong>ordering</strong> of examples. Guide rails:</p>
<ul class="simple">
<li><p>Use the good number of examples that removes ambiguity.</p></li>
<li><p>Begin with a <strong>positive</strong> example that shows the target format.</p></li>
<li><p>Include at least a few <strong>counterexample</strong> if the task has common traps. Mark it clearly with a reason field.</p></li>
<li><p>Use consistent formats across examples and queries.</p></li>
<li><p>When classes are imbalanced in your real data, consider including at least one rare class example so the model sees the pattern.</p></li>
</ul>
<p>A simple scoring trick for example selection uses cosine similarity in an embedding space to pick examples that are close to the query but not identical. That method is outside the scope of this class but worth reading about.</p>
<p>Below task: mark each sentence as <code class="docutils literal notranslate"><span class="pre">ok_for_lab</span></code> or <code class="docutils literal notranslate"><span class="pre">needs_review</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fewshot_instructions</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Classify short safety statements. If the statement is uncertain or suggests a hazardous step without controls, &quot;</span>
    <span class="s2">&quot;mark as needs_review. Return JSON with fields text and label.&quot;</span>
<span class="p">)</span>
<span class="n">ex1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Wear splash goggles when handling concentrated acid.&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;ok_for_lab&quot;</span><span class="p">}</span>
<span class="n">ex2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Heat a sealed vessel vigorously without a pressure relief device.&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;needs_review&quot;</span><span class="p">}</span>
<span class="n">ex3</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Dispose organic waste according to local rules.&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;ok_for_lab&quot;</span><span class="p">}</span>

<span class="n">query_items</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Quench excess hydride with slow addition of isopropanol in an ice bath.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mix nitric acid and acetone in a closed container for storage.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Use a blast shield during high pressure hydrogenation.&quot;</span>
<span class="p">]</span>

<span class="n">fewshot_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="si">{</span><span class="n">fewshot_instructions</span><span class="si">}</span>
<span class="s2">Examples:</span>
<span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ex1</span><span class="p">)</span><span class="si">}</span>
<span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ex2</span><span class="p">)</span><span class="si">}</span>
<span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ex3</span><span class="p">)</span><span class="si">}</span>
<span class="s2">Now classify:</span>
<span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">query_items</span><span class="p">)</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="nb">print</span><span class="p">(</span><span class="n">fewshot_prompt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Classify short safety statements. If the statement is uncertain or suggests a hazardous step without controls, mark as needs_review. Return JSON with fields text and label.
Examples:
{&quot;text&quot;: &quot;Wear splash goggles when handling concentrated acid.&quot;, &quot;label&quot;: &quot;ok_for_lab&quot;}
{&quot;text&quot;: &quot;Heat a sealed vessel vigorously without a pressure relief device.&quot;, &quot;label&quot;: &quot;needs_review&quot;}
{&quot;text&quot;: &quot;Dispose organic waste according to local rules.&quot;, &quot;label&quot;: &quot;ok_for_lab&quot;}
Now classify:
[&quot;Quench excess hydride with slow addition of isopropanol in an ice bath.&quot;, &quot;Mix nitric acid and acetone in a closed container for storage.&quot;, &quot;Use a blast shield during high pressure hydrogenation.&quot;]
</pre></div>
</div>
</div>
</div>
<p>Now let’s see result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">fewshot_prompt</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>```json
[
    {&quot;text&quot;: &quot;Quench excess hydride with slow addition of isopropanol in an ice bath.&quot;, &quot;label&quot;: &quot;ok_for_lab&quot;},
    {&quot;text&quot;: &quot;Mix nitric acid and acetone in a closed container for storage.&quot;, &quot;label&quot;: &quot;needs_review&quot;},
    {&quot;text&quot;: &quot;Use a blast shield during high pressure hydrogenation.&quot;, &quot;label&quot;: &quot;ok_for_lab&quot;}
]
```
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="function-calling-from-prompt-to-tools">
<h2>5. Function calling: from prompt to tools<a class="headerlink" href="#function-calling-from-prompt-to-tools" title="Link to this heading">#</a></h2>
<p>Function calling routes a prompt to a <strong>tool</strong>. The tool performs structured work and returns data that the model can use. We define small tools for unit conversions and RDKit descriptors, then invite the model to pick the right tool given a user question.</p>
<section id="tool-specs-for-an-llm">
<h3>5.1 Tool specs for an LLM<a class="headerlink" href="#tool-specs-for-an-llm" title="Link to this heading">#</a></h3>
<p>You will see the tool specification as a JSON schema. In production you would keep schemas short and stable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span><span class="o">,</span><span class="w"> </span><span class="nn">re</span>
<span class="c1"># Tool 1 - unit conversion</span>
<span class="k">def</span><span class="w"> </span><span class="nf">grams_to_moles</span><span class="p">(</span><span class="n">mass_g</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mw</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">mass_g</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">mw</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">moles_to_grams</span><span class="p">(</span><span class="n">moles</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mw</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">moles</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">mw</span><span class="p">)</span>

<span class="c1"># Tool 2 - small RDKit descriptor set</span>
<span class="k">def</span><span class="w"> </span><span class="nf">rdkit_basic</span><span class="p">(</span><span class="n">smiles</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;MolWt&quot;</span><span class="p">:</span> <span class="n">Descriptors</span><span class="o">.</span><span class="n">MolWt</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span>
        <span class="s2">&quot;LogP&quot;</span><span class="p">:</span> <span class="n">Crippen</span><span class="o">.</span><span class="n">MolLogP</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span>
        <span class="s2">&quot;TPSA&quot;</span><span class="p">:</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">CalcTPSA</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span>
        <span class="s2">&quot;NumRings&quot;</span><span class="p">:</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">CalcNumRings</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span>
    <span class="p">}</span>

<span class="c1"># Tool 3 - tiny search helper</span>
<span class="k">def</span><span class="w"> </span><span class="nf">quick_search</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_results</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># default when model passes null (strict mode)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">/JSON&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">compounds</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PC_Compounds&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">compounds</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]:</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;props&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;CID&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cid&quot;</span><span class="p">)}</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">props</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;urn&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="s2">&quot;sval&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;sval&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;fval&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;fval&quot;</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Example</span>
<span class="nb">print</span><span class="p">(</span><span class="n">quick_search</span><span class="p">(</span><span class="s2">&quot;ethanol safety data&quot;</span><span class="p">))</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tool examples:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;grams_to_moles:&quot;</span><span class="p">,</span> <span class="n">grams_to_moles</span><span class="p">(</span><span class="mf">39.45</span><span class="p">,</span> <span class="mf">46.07</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rdkit_basic:&quot;</span><span class="p">,</span> <span class="n">rdkit_basic</span><span class="p">(</span><span class="s2">&quot;CCO&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;quick_search:&quot;</span><span class="p">,</span> <span class="n">quick_search</span><span class="p">(</span><span class="s2">&quot;ethanol&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
Tool examples:
grams_to_moles: 0.8563056218797482
rdkit_basic: {&#39;MolWt&#39;: 46.069, &#39;LogP&#39;: -0.0014000000000000123, &#39;TPSA&#39;: 20.23, &#39;NumRings&#39;: 0}
quick_search: [{&#39;CID&#39;: 702, &#39;Compound Complexity&#39;: 2.8, &#39;IUPAC Name&#39;: &#39;ethanol&#39;, &#39;InChI&#39;: &#39;InChI=1S/C2H6O/c1-2-3/h3H,2H2,1H3&#39;, &#39;InChIKey&#39;: &#39;LFQSCWFLJHTTHZ-UHFFFAOYSA-N&#39;, &#39;Log P&#39;: -0.1, &#39;Mass&#39;: &#39;46.041864811&#39;, &#39;Molecular Formula&#39;: &#39;C2H6O&#39;, &#39;Molecular Weight&#39;: &#39;46.07&#39;, &#39;SMILES&#39;: &#39;CCO&#39;, &#39;Topological&#39;: 20.2, &#39;Weight&#39;: &#39;46.041864811&#39;}]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="defining-function-specifications">
<h2>5.2 Defining Function Specifications<a class="headerlink" href="#defining-function-specifications" title="Link to this heading">#</a></h2>
<p>Now, let’s learn how we “teach” LLMs to use these functions we alreay have!</p>
<p>So, how do LLMs know <strong>when</strong> and <strong>how</strong> to call functions?</p>
<p>The short answer is we just write the definition for all function we have available locally.</p>
<p>Below is a compact schema description. Different SDKs have slightly different parameter names for function calling. The important piece is the argument schema and the tool name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;grams_to_moles&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Convert grams to moles given molecular weight in g/mol.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;strict&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;mass_g&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Mass in grams&quot;</span><span class="p">,</span> <span class="s2">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                <span class="s2">&quot;mw&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Molecular weight in g/mol&quot;</span><span class="p">,</span> <span class="s2">&quot;exclusiveMinimum&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mass_g&quot;</span><span class="p">,</span> <span class="s2">&quot;mw&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;moles_to_grams&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Convert moles to grams given molecular weight in g/mol.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;strict&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;moles&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Amount in moles&quot;</span><span class="p">,</span> <span class="s2">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                <span class="s2">&quot;mw&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Molecular weight in g/mol&quot;</span><span class="p">,</span> <span class="s2">&quot;exclusiveMinimum&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;moles&quot;</span><span class="p">,</span> <span class="s2">&quot;mw&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;rdkit_basic&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Return MolWt, LogP, TPSA, and NumRings for a SMILES string.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;strict&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;smiles&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;SMILES string&quot;</span><span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;smiles&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;quick_search&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Search PubChem by compound name and return identifiers/properties (uses the &#39;name&#39; endpoint).&quot;</span><span class="p">,</span>
        <span class="s2">&quot;strict&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Compound name to search on PubChem&quot;</span><span class="p">},</span>
                <span class="c1"># allow null so it&#39;s &#39;optional&#39; but still listed in required (strict-mode pattern)</span>
                <span class="s2">&quot;max_results&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;null&quot;</span><span class="p">],</span> <span class="s2">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">,</span> <span class="s2">&quot;max_results&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-on-grams-to-moles">
<h2>5.3 Example on <code class="docutils literal notranslate"><span class="pre">grams_to_moles</span></code><a class="headerlink" href="#example-on-grams-to-moles" title="Link to this heading">#</a></h2>
<p>Now, let’s test with a simple case to calculate the moles of EtOH.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example 1</span>
<span class="n">MODEL</span> <span class="o">=</span> <span class="s2">&quot;gpt-4o&quot;</span>
<span class="n">input_msgs</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;How many moles are in 39154151.45 g of ethanol if MW is 46.07 g/mol?&quot;</span><span class="p">}]</span>

<span class="c1"># 1) Ask the model with tools</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">input_msgs</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># 2) Execute any tool calls and append outputs</span>
<span class="n">input_msgs</span> <span class="o">+=</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;function_call&quot;</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;grams_to_moles&quot;</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;moles&quot;</span><span class="p">:</span> <span class="n">grams_to_moles</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)}</span>
        <span class="n">input_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function_call_output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;call_id&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">call_id</span><span class="p">,</span>
            <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">})</span>

<span class="c1"># 3) Ask for final answer</span>
<span class="n">final</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">input_msgs</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="n">instructions</span><span class="o">=</span><span class="s2">&quot;Use the tool output and include units.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are approximately 849,883.90 moles in 39,154,151.45 g of ethanol.
</pre></div>
</div>
</div>
</div>
<p>Below code cell is showing you how the function-calling “scheme” (or flow) actually works under the hood in your Colab or notebook environment.</p>
<p>It has exactly same input as the one above, but we just add more print statements to show how this is done step by step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example 1 — step by step trace</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>

<span class="n">MODEL</span> <span class="o">=</span> <span class="s2">&quot;gpt-4o&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_as_json</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># OpenAI SDK objects usually have model_dump or model_dump_json</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;model_dump&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;model_dump_json&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s2">&quot;__dict__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">))))</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Step 0: user input</span>
<span class="n">input_msgs</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;How many moles are in 39154151.45 g of ethanol if MW is 46.07 g/mol?&quot;</span><span class="p">}]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Step 0: User input ---&quot;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">input_msgs</span><span class="p">)</span>

<span class="c1"># Step 1: ask the model with tools</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">input_msgs</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="n">parallel_tool_calls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">tool_choice</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Step 1: Model output items ---&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">_as_json</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[output </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">] type=</span><span class="si">{</span><span class="n">j</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, name=</span><span class="si">{</span><span class="n">j</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;function_call&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  arguments:&quot;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;arguments&quot;</span><span class="p">))</span>

<span class="c1"># Keep a running transcript like the docs</span>
<span class="n">input_msgs</span> <span class="o">+=</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span>

<span class="c1"># Step 2: execute any tool calls and append outputs</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Step 2: Executing tool calls ---&quot;</span><span class="p">)</span>
<span class="n">made_call</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;function_call&quot;</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;grams_to_moles&quot;</span><span class="p">:</span>
        <span class="n">made_call</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">arguments</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Function called: grams_to_moles&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arguments:&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

        <span class="n">result_obj</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;moles&quot;</span><span class="p">:</span> <span class="n">grams_to_moles</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)}</span>
        <span class="n">result_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result_obj</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tool result:&quot;</span><span class="p">,</span> <span class="n">result_obj</span><span class="p">)</span>

        <span class="c1"># Append function_call_output for this call_id</span>
        <span class="n">input_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function_call_output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;call_id&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">call_id</span><span class="p">,</span>
            <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">result_json</span>
        <span class="p">})</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">made_call</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No function_call received. You can force it with tool_choice={&#39;type&#39;:&#39;function&#39;,&#39;name&#39;:&#39;grams_to_moles&#39;}.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Step 2b: Messages after appending tool output ---&quot;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">([</span><span class="n">_as_json</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">input_msgs</span><span class="p">])</span>

<span class="c1"># Step 3: ask for final answer (second round)</span>
<span class="n">final</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">input_msgs</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="n">instructions</span><span class="o">=</span><span class="s2">&quot;Use the tool output and include units.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Step 3: Final response object (summary) ---&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>

<span class="c1"># Optional: show raw items from the final response</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Step 3b: Final response raw items ---&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">_as_json</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[final </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">] type=</span><span class="si">{</span><span class="n">j</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span>
        <span class="c1"># typical text message content is in output_text, but show the item too</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Step 0: User input ---
[{&#39;content&#39;: &#39;How many moles are in 39154151.45 g of ethanol if MW is 46.07 &#39;
             &#39;g/mol?&#39;,
  &#39;role&#39;: &#39;user&#39;}]

--- Step 1: Model output items ---
[output 0] type=function_call, name=grams_to_moles
  arguments: {&quot;mass_g&quot;:39154151.45,&quot;mw&quot;:46.07}

--- Step 2: Executing tool calls ---
Function called: grams_to_moles
Arguments: {&#39;mass_g&#39;: 39154151.45, &#39;mw&#39;: 46.07}
Tool result: {&#39;moles&#39;: 849883.9038419797}

--- Step 2b: Messages after appending tool output ---
[{&#39;content&#39;: &#39;How many moles are in 39154151.45 g of ethanol if MW is 46.07 &#39;
             &#39;g/mol?&#39;,
  &#39;role&#39;: &#39;user&#39;},
 {&#39;arguments&#39;: &#39;{&quot;mass_g&quot;:39154151.45,&quot;mw&quot;:46.07}&#39;,
  &#39;call_id&#39;: &#39;call_5hTDLfSW1OmrDIiPBi54xTSh&#39;,
  &#39;id&#39;: &#39;fc_0a45f5bd9e695af9006910c41d77e081909c44bb99a9533f80&#39;,
  &#39;name&#39;: &#39;grams_to_moles&#39;,
  &#39;status&#39;: &#39;completed&#39;,
  &#39;type&#39;: &#39;function_call&#39;},
 {&#39;call_id&#39;: &#39;call_5hTDLfSW1OmrDIiPBi54xTSh&#39;,
  &#39;output&#39;: &#39;{&quot;moles&quot;: 849883.9038419797}&#39;,
  &#39;type&#39;: &#39;function_call_output&#39;}]

--- Step 3: Final response object (summary) ---
There are approximately 849,884 moles in 39,154,151.45 grams of ethanol.

--- Step 3b: Final response raw items ---
[final 0] type=message
{&#39;content&#39;: [{&#39;annotations&#39;: [],
              &#39;logprobs&#39;: [],
              &#39;text&#39;: &#39;There are approximately 849,884 moles in 39,154,151.45 &#39;
                      &#39;grams of ethanol.&#39;,
              &#39;type&#39;: &#39;output_text&#39;}],
 &#39;id&#39;: &#39;msg_0a45f5bd9e695af9006910c41f16908190b714c2052a4b032d&#39;,
 &#39;role&#39;: &#39;assistant&#39;,
 &#39;status&#39;: &#39;completed&#39;,
 &#39;type&#39;: &#39;message&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-on-rdkit-basic">
<h2>5.4 Example on <code class="docutils literal notranslate"><span class="pre">rdkit_basic</span></code><a class="headerlink" href="#example-on-rdkit-basic" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cell 3: Example 2</span>

<span class="n">input_msgs</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Give MolWt, LogP, TPSA, and NumRings for ethanol, SMILES CCO.&quot;</span><span class="p">}]</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">input_msgs</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">input_msgs</span> <span class="o">+=</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
    <span class="c1">#print(item)    #Uncomment this one to see model&#39;s decision</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;function_call&quot;</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;rdkit_basic&quot;</span><span class="p">:</span>
        <span class="c1">#print(item.arguments)   #Uncomment this one to see what model decides to input for the function</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">rdkit_basic</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="n">input_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function_call_output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;call_id&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">call_id</span><span class="p">,</span>
            <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">})</span>

<span class="n">final</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">input_msgs</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="c1">#instructions=&quot;Summarize the descriptor values clearly.&quot; #This user input is optional</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Here are the properties of ethanol (SMILES: CCO):

- **Molecular Weight (MolWt):** 46.069 g/mol
- **LogP:** -0.0014
- **Topological Polar Surface Area (TPSA):** 20.23 Å²
- **Number of Rings (NumRings):** 0
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-on-pubchem-search">
<h2>5.5 Example on PubChem search<a class="headerlink" href="#example-on-pubchem-search" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cell 4: Example 3</span>

<span class="n">input_msgs</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Find asprin on PubChem by name and give IUPAC name, MW, formula.&quot;</span><span class="p">}]</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">input_msgs</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">input_msgs</span> <span class="o">+=</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;function_call&quot;</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;quick_search&quot;</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">quick_search</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)}</span>
        <span class="n">input_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function_call_output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;call_id&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">call_id</span><span class="p">,</span>
            <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">})</span>

<span class="n">final</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">input_msgs</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Aspirin has the following chemical properties:

- **IUPAC Name**: 2-acetoxybenzoic acid
- **Molecular Weight**: 180.16 g/mol
- **Molecular Formula**: C₉H₈O₄
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-multiple-tools-in-one-conversation">
<h2>5.6 Using multiple tools in one conversation<a class="headerlink" href="#using-multiple-tools-in-one-conversation" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Multi-tool loop: the model can keep calling tools until no more function_call items appear.</span>
<span class="c1"># Assumes you already defined: client, MODEL, tools, grams_to_moles, moles_to_grams, rdkit_basic, quick_search</span>

<span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;I have 9,999,992.14 g of asprin, and I do not know its molecular weight. &quot;</span>
    <span class="s2">&quot;Look up the MW online and convert that to moles. &quot;</span>
<span class="p">)</span>

<span class="n">messages</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}]</span>

<span class="n">round_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">round_idx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">===== Round </span><span class="si">{</span><span class="n">round_idx</span><span class="si">}</span><span class="s2">: model call =====&quot;</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>            <span class="c1"># e.g., &quot;gpt-4o&quot;</span>
        <span class="nb">input</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
        <span class="n">parallel_tool_calls</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>     <span class="c1"># allow multiple tool calls per turn</span>
        <span class="n">tool_choice</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>           <span class="c1"># let the model decide,</span>
    <span class="p">)</span>

    <span class="c1"># Show what the model returned this round</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[item </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] type=</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="p">(</span><span class="s1">&#39;name=&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s2">&quot;function_call&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  arguments:&quot;</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>

    <span class="c1"># Add the model output to the transcript</span>
    <span class="n">messages</span> <span class="o">+=</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span>

    <span class="c1"># Execute any tool calls we received</span>
    <span class="n">made_any_call</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;function_call&quot;</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">made_any_call</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">arguments</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Executing tool: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arguments:&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s2">&quot;grams_to_moles&quot;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;moles&quot;</span><span class="p">:</span> <span class="n">grams_to_moles</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)}</span>
            <span class="k">elif</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s2">&quot;moles_to_grams&quot;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;grams&quot;</span><span class="p">:</span> <span class="n">moles_to_grams</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)}</span>
            <span class="k">elif</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s2">&quot;rdkit_basic&quot;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">rdkit_basic</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s2">&quot;quick_search&quot;</span><span class="p">:</span>
                <span class="c1"># strict-mode pattern may send null; treat None as default</span>
                <span class="k">if</span> <span class="s2">&quot;max_results&quot;</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;max_results&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">args</span><span class="p">[</span><span class="s2">&quot;max_results&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">quick_search</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unknown tool </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tool output:&quot;</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># Append tool output back to the conversation for the model to use next round</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function_call_output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;call_id&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">call_id</span><span class="p">,</span>
            <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">})</span>

    <span class="c1"># If no tools were requested this round, we are done and can show the final text</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">made_any_call</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">===== Final response =====&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>===== Round 1: model call =====
[item 0] type=function_call name=quick_search
  arguments: {&quot;query&quot;:&quot;aspirin&quot;,&quot;max_results&quot;:1}

Executing tool: quick_search
Arguments: {&#39;query&#39;: &#39;aspirin&#39;, &#39;max_results&#39;: 1}
Tool output:
{&#39;results&#39;: [{&#39;CID&#39;: 2244,
              &#39;Compound Complexity&#39;: 212,
              &#39;IUPAC Name&#39;: &#39;2-acetoxybenzoic acid&#39;,
              &#39;InChI&#39;: &#39;InChI=1S/C9H8O4/c1-6(10)13-8-5-3-2-4-7(8)9(11)12/h2-5H,1H3,(H,11,12)&#39;,
              &#39;InChIKey&#39;: &#39;BSYNRYMUTXBXSQ-UHFFFAOYSA-N&#39;,
              &#39;Log P&#39;: 1.2,
              &#39;Mass&#39;: &#39;180.04225873&#39;,
              &#39;Molecular Formula&#39;: &#39;C9H8O4&#39;,
              &#39;Molecular Weight&#39;: &#39;180.16&#39;,
              &#39;SMILES&#39;: &#39;CC(=O)OC1=CC=CC=C1C(=O)O&#39;,
              &#39;Topological&#39;: 63.6,
              &#39;Weight&#39;: &#39;180.04225873&#39;}]}

===== Round 2: model call =====
[item 0] type=function_call name=grams_to_moles
  arguments: {&quot;mass_g&quot;:9999992.14,&quot;mw&quot;:180.16}

Executing tool: grams_to_moles
Arguments: {&#39;mass_g&#39;: 9999992.14, &#39;mw&#39;: 180.16}
Tool output:
{&#39;moles&#39;: 55506.173068383665}

===== Round 3: model call =====
[item 0] type=message 

===== Final response =====
The molecular weight of aspirin is 180.16 g/mol. You have approximately 55,506.17 moles of aspirin.
</pre></div>
</div>
</div>
</div>
<p>Below is a summary of function caling workflow:</p>
<p>Credit: OpenAI</p>
<p>Further reading: <a class="reference external" href="https://platform.openai.com/docs/guides/function-calling">https://platform.openai.com/docs/guides/function-calling</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.openai.com/API/docs/images/function-calling-diagram-steps.png&quot;</span><span class="p">,</span>    <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><img src="https://cdn.openai.com/API/docs/images/function-calling-diagram-steps.png" width="600" height="800"/></div></div>
</div>
</section>
<section id="use-a-pre-trained-model-as-a-tool">
<h2>5.7 Use a pre-trained model as a tool<a class="headerlink" href="#use-a-pre-trained-model-as-a-tool" title="Link to this heading">#</a></h2>
<p>Many labs fit scikit-learn models to predict properties. Here we train a small random forest on a chemistry dataset, then expose a function <code class="docutils literal notranslate"><span class="pre">rf_predict</span></code> that the model can call. This turns a model into a tool in the same style as unit converters. We reuse the <strong>C_H_oxidation_dataset.csv</strong> from Lecture 7.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/zzhenglab/ai4chem/main/book/_data/C_H_oxidation_dataset.csv&quot;</span>
<span class="n">df_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded rows:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_raw</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_raw</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calc_desc</span><span class="p">(</span><span class="n">smiles</span><span class="p">):</span>
  <span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;MolWt&quot;</span><span class="p">:</span> <span class="n">Descriptors</span><span class="o">.</span><span class="n">MolWt</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span>
                <span class="s2">&quot;LogP&quot;</span><span class="p">:</span> <span class="n">Crippen</span><span class="o">.</span><span class="n">MolLogP</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span>
                <span class="s2">&quot;TPSA&quot;</span><span class="p">:</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">CalcTPSA</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span>
                <span class="s2">&quot;NumRings&quot;</span><span class="p">:</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">CalcNumRings</span><span class="p">(</span><span class="n">mol</span><span class="p">)})</span>

<span class="n">desc</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="s2">&quot;SMILES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calc_desc</span><span class="p">)</span>
<span class="n">df_model</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_raw</span><span class="p">,</span> <span class="n">desc</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columns:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_model</span><span class="o">.</span><span class="n">columns</span><span class="p">)[:</span><span class="mi">10</span><span class="p">],</span> <span class="s2">&quot;...&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_model</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded rows: 575
</pre></div>
</div>
<div class="output text_html">
  <div id="df-ef982823-0542-42d1-aed8-27b2668427ed" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Compound Name</th>
      <th>CAS</th>
      <th>SMILES</th>
      <th>Solubility_mol_per_L</th>
      <th>pKa</th>
      <th>Toxicity</th>
      <th>Melting Point</th>
      <th>Reactivity</th>
      <th>Oxidation Site</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3,4-dihydro-1H-isochromene</td>
      <td>493-05-0</td>
      <td>c1ccc2c(c1)CCOC2</td>
      <td>0.103906</td>
      <td>5.80</td>
      <td>non_toxic</td>
      <td>65.8</td>
      <td>1</td>
      <td>8,10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9H-fluorene</td>
      <td>86-73-7</td>
      <td>c1ccc2c(c1)Cc1ccccc1-2</td>
      <td>0.010460</td>
      <td>5.82</td>
      <td>toxic</td>
      <td>90.0</td>
      <td>1</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1,2,3,4-tetrahydronaphthalene</td>
      <td>119-64-2</td>
      <td>c1ccc2c(c1)CCCC2</td>
      <td>0.020589</td>
      <td>5.74</td>
      <td>toxic</td>
      <td>69.4</td>
      <td>1</td>
      <td>7,10</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-ef982823-0542-42d1-aed8-27b2668427ed')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-ef982823-0542-42d1-aed8-27b2668427ed button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-ef982823-0542-42d1-aed8-27b2668427ed');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-19ddfb2a-607c-4e79-affa-88355824c5e8">
      <button class="colab-df-quickchart" onclick="quickchart('df-19ddfb2a-607c-4e79-affa-88355824c5e8')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-19ddfb2a-607c-4e79-affa-88355824c5e8 button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Columns: [&#39;Compound Name&#39;, &#39;CAS&#39;, &#39;SMILES&#39;, &#39;Solubility_mol_per_L&#39;, &#39;pKa&#39;, &#39;Toxicity&#39;, &#39;Melting Point&#39;, &#39;Reactivity&#39;, &#39;Oxidation Site&#39;, &#39;MolWt&#39;] ...
</pre></div>
</div>
<div class="output text_html">
  <div id="df-9490b67d-6b76-4d23-b422-d4c7d3eb210a" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Compound Name</th>
      <th>CAS</th>
      <th>SMILES</th>
      <th>Solubility_mol_per_L</th>
      <th>pKa</th>
      <th>Toxicity</th>
      <th>Melting Point</th>
      <th>Reactivity</th>
      <th>Oxidation Site</th>
      <th>MolWt</th>
      <th>LogP</th>
      <th>TPSA</th>
      <th>NumRings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3,4-dihydro-1H-isochromene</td>
      <td>493-05-0</td>
      <td>c1ccc2c(c1)CCOC2</td>
      <td>0.103906</td>
      <td>5.80</td>
      <td>non_toxic</td>
      <td>65.8</td>
      <td>1</td>
      <td>8,10</td>
      <td>134.178</td>
      <td>1.7593</td>
      <td>9.23</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9H-fluorene</td>
      <td>86-73-7</td>
      <td>c1ccc2c(c1)Cc1ccccc1-2</td>
      <td>0.010460</td>
      <td>5.82</td>
      <td>toxic</td>
      <td>90.0</td>
      <td>1</td>
      <td>7</td>
      <td>166.223</td>
      <td>3.2578</td>
      <td>0.00</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-9490b67d-6b76-4d23-b422-d4c7d3eb210a')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-9490b67d-6b76-4d23-b422-d4c7d3eb210a button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-9490b67d-6b76-4d23-b422-d4c7d3eb210a');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-340e5257-6bb3-4df4-aa11-ae60bcc558fd">
      <button class="colab-df-quickchart" onclick="quickchart('df-340e5257-6bb3-4df4-aa11-ae60bcc558fd')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-340e5257-6bb3-4df4-aa11-ae60bcc558fd button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>
</div></div>
</div>
<p>Now we train a small random forest. For demo purpose, we use a simple target such as <strong>Melting Point</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MolWt&quot;</span><span class="p">,</span> <span class="s2">&quot;LogP&quot;</span><span class="p">,</span> <span class="s2">&quot;TPSA&quot;</span><span class="p">,</span> <span class="s2">&quot;NumRings&quot;</span><span class="p">]</span>

<span class="c1"># Compute descriptors if missing</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">base_feats</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df_model</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
    <span class="n">desc_df</span> <span class="o">=</span> <span class="n">df_model</span><span class="p">[</span><span class="s2">&quot;SMILES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">rdkit_basic</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
    <span class="n">df_model</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_model</span><span class="p">,</span> <span class="n">desc_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Prepare target as 1/0</span>
<span class="n">lab</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_model</span><span class="p">[</span><span class="s2">&quot;Toxicity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">label_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;toxic&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;non_toxic&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="n">df_model</span><span class="p">[</span><span class="s2">&quot;_tox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">label_map</span><span class="p">)</span>

<span class="c1"># Clean rows</span>
<span class="n">use_cols</span> <span class="o">=</span> <span class="n">base_feats</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;_tox&quot;</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">df_model</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">use_cols</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">base_feats</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_tox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="c1">#Split, Train</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">  F1: </span><span class="si">{</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy: 0.965  F1: 0.979
</pre></div>
</div>
</div>
</div>
<p>Now we wrap a SMILES toxicity predictor</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FEATURES_USED</span> <span class="o">=</span> <span class="n">base_feats</span>  <span class="c1"># keep the order for inference</span>

<span class="k">def</span><span class="w"> </span><span class="nf">predict_toxicity_from_smiles</span><span class="p">(</span><span class="n">smiles</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
  <span class="c1"># SMILES -&gt; descriptors -&gt; toxicity prediction</span>

    <span class="k">if</span> <span class="s2">&quot;clf&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span> <span class="ow">or</span> <span class="n">clf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Classifier not trained.&quot;</span><span class="p">}</span>

    <span class="n">desc</span> <span class="o">=</span> <span class="n">rdkit_basic</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">desc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">FEATURES_USED</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">proba</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;toxic&quot;</span> <span class="k">if</span> <span class="n">proba</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;non_toxic&quot;</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;smiles&quot;</span><span class="p">:</span> <span class="n">smiles</span><span class="p">},</span>
        <span class="s2">&quot;descriptors&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">desc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">FEATURES_USED</span><span class="p">},</span>
        <span class="s2">&quot;features_used&quot;</span><span class="p">:</span> <span class="n">FEATURES_USED</span><span class="p">,</span>
        <span class="s2">&quot;prediction&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span> <span class="s2">&quot;probability&quot;</span><span class="p">:</span> <span class="n">proba</span><span class="p">}</span>
    <span class="p">}</span>


<span class="n">predict_toxicity_from_smiles</span><span class="p">(</span><span class="s2">&quot;COO&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ok&#39;: True,
 &#39;input&#39;: {&#39;smiles&#39;: &#39;COO&#39;},
 &#39;descriptors&#39;: {&#39;MolWt&#39;: 48.041000000000004,
  &#39;LogP&#39;: 0.10580000000000006,
  &#39;TPSA&#39;: 29.46,
  &#39;NumRings&#39;: 0},
 &#39;features_used&#39;: [&#39;MolWt&#39;, &#39;LogP&#39;, &#39;TPSA&#39;, &#39;NumRings&#39;],
 &#39;prediction&#39;: {&#39;label&#39;: &#39;non_toxic&#39;, &#39;probability&#39;: 0.06}}
</pre></div>
</div>
</div>
</div>
<p>Similarly, we need to write tool specifications so later LLMs will know how to use it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tox_tool</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;predict_toxicity_from_smiles&quot;</span><span class="p">,</span>
    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Given a SMILES, compute RDKit descriptors and predict toxicity (toxic/non_toxic) using the trained classifier.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;strict&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
        <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;smiles&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Input SMILES string&quot;</span><span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;smiles&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">tox_tool</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can ask LLMs questions, and they will use our in-house functions to make predictions and interpret the answers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_msg</span> <span class="o">=</span> <span class="s2">&quot;Is Lactic acid toxic? How likely?&quot;</span>

<span class="n">messages</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">user_msg</span><span class="p">}]</span>

<span class="c1"># Round 1: model decides to call the tool</span>
<span class="n">resp1</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="n">parallel_tool_calls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">tool_choice</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">messages</span> <span class="o">+=</span> <span class="n">resp1</span><span class="o">.</span><span class="n">output</span>

<span class="c1"># Execute tool calls and append outputs</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">resp1</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;function_call&quot;</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;predict_toxicity_from_smiles&quot;</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">arguments</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">predict_toxicity_from_smiles</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function_call_output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;call_id&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">call_id</span><span class="p">,</span>
            <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="p">})</span>

<span class="c1"># Round 2: final answer</span>
<span class="n">resp2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">resp2</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lactic acid is predicted to be non-toxic with a probability of 7%.
</pre></div>
</div>
</div>
</div>
<p>Now, we cab combine in-house functions together with search tools and do function callings. In this case, you just ask questions in human natural languge, the LLM help search for the SMILES notations and put it to the ML tools for prediction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_tool</span> <span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;quick_search&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Search PubChem by compound name and return identifiers/properties. Use this to find a SMILES.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;strict&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Compound name to search on PubChem&quot;</span><span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">tox_tool</span><span class="p">,</span> <span class="n">search_tool</span><span class="p">]</span>

<span class="c1"># ---- Conversation loop ----</span>
<span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;What is the toxicity for EGFR inhibitor? Do not guess.&quot;</span>
<span class="p">)</span>

<span class="n">messages</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}]</span>

<span class="n">round_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">round_idx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">===== Round </span><span class="si">{</span><span class="n">round_idx</span><span class="si">}</span><span class="s2"> =====&quot;</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">MODEL</span><span class="p">,</span>
        <span class="nb">input</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
        <span class="n">parallel_tool_calls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>   <span class="c1"># encourage two rounds: search then predict</span>
        <span class="n">tool_choice</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Inspect model outputs</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[item </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] type=</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="p">(</span><span class="s1">&#39;name=&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s2">&quot;function_call&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  arguments:&quot;</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>

    <span class="c1"># Add model output to the thread</span>
    <span class="n">messages</span> <span class="o">+=</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span>

    <span class="c1"># Execute tool calls</span>
    <span class="n">made_call</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;function_call&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">made_call</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">arguments</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;quick_search&quot;</span><span class="p">:</span>
            <span class="c1"># Use your existing quick_search() directly</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">quick_search</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)}</span>
        <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;predict_toxicity_from_smiles&quot;</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">predict_toxicity_from_smiles</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unknown tool </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tool output:&quot;</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function_call_output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;call_id&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">call_id</span><span class="p">,</span>
            <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="p">})</span>

    <span class="c1"># Stop when model stops calling tools</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">made_call</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">===== Final =====&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">output_text</span><span class="p">)</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>===== Round 1 =====
[item 0] type=function_call name=quick_search
  arguments: {&quot;query&quot;:&quot;EGFR inhibitor&quot;}
Tool output:
{&#39;results&#39;: [{&#39;CID&#39;: 9549299,
              &#39;Compound Complexity&#39;: 585,
              &#39;IUPAC Name&#39;: &#39;N-[3-[[6-[3-(trifluoromethyl)anilino]pyrimidin-4-yl]amino]phenyl]cyclopropanecarboxamide&#39;,
              &#39;InChI&#39;: &#39;InChI=1S/C21H18F3N5O/c22-21(23,24)14-3-1-4-15(9-14)27-18-11-19(26-12-25-18)28-16-5-2-6-17(10-16)29-20(30)13-7-8-13/h1-6,9-13H,7-8H2,(H,29,30)(H2,25,26,27,28)&#39;,
              &#39;InChIKey&#39;: &#39;YOHYSYJDKVYCJI-UHFFFAOYSA-N&#39;,
              &#39;Log P&#39;: 4.5,
              &#39;Mass&#39;: &#39;413.14634470&#39;,
              &#39;Molecular Formula&#39;: &#39;C21H18F3N5O&#39;,
              &#39;Molecular Weight&#39;: &#39;413.4&#39;,
              &#39;SMILES&#39;: &#39;C1CC1C(=O)NC2=CC=CC(=C2)NC3=NC=NC(=C3)NC4=CC=CC(=C4)C(F)(F)F&#39;,
              &#39;Topological&#39;: 78.9,
              &#39;Weight&#39;: &#39;413.14634470&#39;}]}

===== Round 2 =====
[item 0] type=function_call name=predict_toxicity_from_smiles
  arguments: {&quot;smiles&quot;:&quot;C1CC1C(=O)NC2=CC=CC(=C2)NC3=NC=NC(=C3)NC4=CC=CC(=C4)C(F)(F)F&quot;}
Tool output:
{&#39;descriptors&#39;: {&#39;LogP&#39;: 5.331100000000002,
                 &#39;MolWt&#39;: 413.4030000000001,
                 &#39;NumRings&#39;: 4,
                 &#39;TPSA&#39;: 78.94},
 &#39;features_used&#39;: [&#39;MolWt&#39;, &#39;LogP&#39;, &#39;TPSA&#39;, &#39;NumRings&#39;],
 &#39;input&#39;: {&#39;smiles&#39;: &#39;C1CC1C(=O)NC2=CC=CC(=C2)NC3=NC=NC(=C3)NC4=CC=CC(=C4)C(F)(F)F&#39;},
 &#39;ok&#39;: True,
 &#39;prediction&#39;: {&#39;label&#39;: &#39;toxic&#39;, &#39;probability&#39;: 1.0}}

===== Round 3 =====
[item 0] type=message 

===== Final =====
The EGFR inhibitor with the given structure is predicted to be toxic, with a high certainty (probability: 1.0).
</pre></div>
</div>
</div>
</div>
</section>
<section id="glossary">
<h2>6. Glossary<a class="headerlink" href="#glossary" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Zero-shot</strong>: a prompt with no examples. The request must define the desired shape and scope.</p></li>
<li><p><strong>One-shot</strong>: a prompt with one example. The model mimics the pattern in your example.</p></li>
<li><p><strong>Few-shot</strong>: a prompt with several examples. Use when a single example is not enough to pin down the pattern.</p></li>
<li><p><strong>Function calling</strong>: a feature that lets a model request a tool with structured arguments and consume the tool output.</p></li>
<li><p><strong>Schema</strong>: a compact specification of argument names and types for a tool. Usually a JSON object with required fields.</p></li>
<li><p><strong>JSON</strong>: a plain data format for predictable programmatic parsing.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lecture-22.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture 22 - Vision Languge Models</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">1. Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#zero-shot-prompts-for-chemistry">2. Zero-shot prompts for chemistry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ask-for-a-single-value">2.1 Ask for a single value</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#request-a-list-with-structure">2.2 Request a list with structure</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#one-shot-and-few-shot-patterns">3. One-shot and few-shot patterns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-shot-name-to-smiles">3.1 One-shot: name to SMILES</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#few-shot-classify-short-safety-statements">3.2 Few-shot: classify short safety statements</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#function-calling-from-prompt-to-tools">5. Function calling: from prompt to tools</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tool-specs-for-an-llm">5.1 Tool specs for an LLM</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-function-specifications">5.2 Defining Function Specifications</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-on-grams-to-moles">5.3 Example on <code class="docutils literal notranslate"><span class="pre">grams_to_moles</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-on-rdkit-basic">5.4 Example on <code class="docutils literal notranslate"><span class="pre">rdkit_basic</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-on-pubchem-search">5.5 Example on PubChem search</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-multiple-tools-in-one-conversation">5.6 Using multiple tools in one conversation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-pre-trained-model-as-a-tool">5.7 Use a pre-trained model as a tool</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glossary">6. Glossary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>