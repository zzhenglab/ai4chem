

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lecture 6 - Supervised Learning &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lecture-06';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to CHEM 5080: AI for Chemistry
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lecture-01.html">Lecture 1 - Python Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-02.html">Lecture 2 - Pandas and Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-03.html">Lecture 3 - SMILES and RDKit</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-04.html">Lecture 4 - Chemical Structure Identifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture-05.html">Lecture 5 - Regression and Classification</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Flecture-06.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/lecture-06.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 6 - Supervised Learning</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-and-setup">1. Dataset and setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-environment">1.1 Imports and environment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data-and-build-descriptors">1.2 Load data and build descriptors</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-exploratory-data-analysis-eda">2. Quick Exploratory Data Analysis (EDA)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptor-histograms">2.1 Descriptor histograms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pairwise-relationships">2.2 Pairwise relationships</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#redundancy-demo-and-correlation">2.3 Redundancy demo and correlation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-hyperparameters">3. Introduction to hyperparameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-split-evaluation">3.1 Single split evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-of-alpha-plot">3.2 Effect of alpha (plot)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-validation">4. Cross validation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection-evaluation-and-prediction">5. Model selection, evaluation and prediction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#endtoend-workflow-and-grid-search">6. End‑to‑end workflow and grid search</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#explaining-the-model-with-feature-importance">7. Explaining the model with feature importance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glossary">8. Glossary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-reference">9. Quick reference</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inclass-activity">10. In‑class activity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#q1-prepare-logsolubility-and-visualize">Q1. Prepare log‑solubility and visualize</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#q2-tune-ridge-on-the-training-split">Q2. Tune Ridge on the training split</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#q3-evaluate-ridge-on-test-and-draw-diagnostics">Q3. Evaluate Ridge on test and draw diagnostics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#q4-predict-two-new-molecules-ridge">Q4. Predict two new molecules (Ridge)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#q5-interpret-ridge-with-coefficients-and-permutation-importance">Q5. Interpret Ridge with coefficients and permutation importance</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lecture-6-supervised-learning">
<h1>Lecture 6 - Supervised Learning<a class="headerlink" href="#lecture-6-supervised-learning" title="Permalink to this heading">#</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#learning-goals" id="id1">Learning goals</a></p></li>
<li><p><a class="reference internal" href="#dataset-and-setup" id="id2">1. Dataset and setup</a></p></li>
<li><p><a class="reference internal" href="#quick-exploratory-data-analysis-eda" id="id3">2. Quick Exploratory Data Analysis (EDA)</a></p></li>
<li><p><a class="reference internal" href="#introduction-to-hyperparameters" id="id4">3. Introduction to hyperparameters</a></p></li>
<li><p><a class="reference internal" href="#cross-validation" id="id5">4. Cross validation</a></p></li>
<li><p><a class="reference internal" href="#model-selection-evaluation-and-prediction" id="id6">5. Model selection, evaluation and prediction</a></p></li>
<li><p><a class="reference internal" href="#endtoend-workflow-and-grid-search" id="id7">6. End‑to‑end workflow and grid search</a></p></li>
<li><p><a class="reference internal" href="#explaining-the-model-with-feature-importance" id="id8">7. Explaining the model with feature importance</a></p></li>
<li><p><a class="reference internal" href="#glossary" id="id9">8. Glossary</a></p></li>
<li><p><a class="reference internal" href="#quick-reference" id="id10">9. Quick reference</a></p></li>
<li><p><a class="reference internal" href="#inclass-activity" id="id11">10. In‑class activity</a></p></li>
</ul>
</nav>
<section id="learning-goals">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Learning goals</a><a class="headerlink" href="#learning-goals" title="Permalink to this heading">#</a></h2>
<ul>
<li><p>Recognize when to try Random Forest, SVM, KNN, and Decision Trees.</p></li>
<li><p>Use <strong>KFold</strong> and <strong>cross_val_score</strong> for fair evaluation.</p></li>
<li><p>Spot <strong>overfitting</strong> and control model complexity.</p></li>
<li><p>Tune hyperparameters with <strong>GridSearchCV</strong>.</p></li>
<li><p>Explain predictions using <strong>feature importance</strong> and <strong>permutation importance</strong>.</p>
<p><a class="reference external" href="https://colab.research.google.com/drive/1vjb0L9j2XJ76u5xcmuGrl0P2O8tX-tzf?usp=sharing"><img alt="Colab" src="https://img.shields.io/badge/Open-Colab-orange" /></a></p>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="dataset-and-setup">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">1. Dataset and setup</a><a class="headerlink" href="#dataset-and-setup" title="Permalink to this heading">#</a></h2>
<div class="admonition-why-this-dataset admonition">
<p class="admonition-title">Why this dataset?</p>
<p>We will reuse the same table from Lecture 5. It includes SMILES plus targets such as <strong>Melting Point</strong> and <strong>Toxicity</strong>. We compute four lightweight descriptors that we already trust: <code class="docutils literal notranslate"><span class="pre">MolWt</span></code>, <code class="docutils literal notranslate"><span class="pre">LogP</span></code>, <code class="docutils literal notranslate"><span class="pre">TPSA</span></code>, <code class="docutils literal notranslate"><span class="pre">NumRings</span></code>. They are fast to compute, easy to interpret, and good enough to demonstrate model selection and cross‑validation.</p>
</div>
<section id="imports-and-environment">
<h3>1.1 Imports and environment<a class="headerlink" href="#imports-and-environment" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Commented out IPython magic to ensure Python compatibility.</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">rdkit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Chem</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">rdkit.Chem</span><span class="w"> </span><span class="kn">import</span> <span class="n">Draw</span><span class="p">,</span> <span class="n">Descriptors</span><span class="p">,</span> <span class="n">Crippen</span><span class="p">,</span> <span class="n">rdMolDescriptors</span><span class="p">,</span> <span class="n">AllChem</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
<span class="c1">#         %pip install rdkit</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">rdkit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Chem</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">rdkit.Chem</span><span class="w"> </span><span class="kn">import</span> <span class="n">Draw</span><span class="p">,</span> <span class="n">Descriptors</span><span class="p">,</span> <span class="n">Crippen</span><span class="p">,</span> <span class="n">rdMolDescriptors</span><span class="p">,</span> <span class="n">AllChem</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RDKit is not available in this environment. Drawing and descriptors will be skipped.&quot;</span><span class="p">)</span>
        <span class="n">Chem</span> <span class="o">=</span> <span class="kc">None</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">rdkit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Chem</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rdkit.Chem</span><span class="w"> </span><span class="kn">import</span> <span class="n">Descriptors</span><span class="p">,</span> <span class="n">Crippen</span><span class="p">,</span> <span class="n">rdMolDescriptors</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">KFold</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">validation_curve</span><span class="p">,</span> <span class="n">learning_curve</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">lasso_path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.svm</span><span class="w"> </span><span class="kn">import</span> <span class="n">SVR</span><span class="p">,</span> <span class="n">SVC</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neural_network</span><span class="w"> </span><span class="kn">import</span> <span class="n">MLPRegressor</span><span class="p">,</span> <span class="n">MLPClassifier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">KNeighborsRegressor</span><span class="p">,</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.feature_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">SelectFromModel</span><span class="p">,</span> <span class="n">RFE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.inspection</span><span class="w"> </span><span class="kn">import</span> <span class="n">permutation_importance</span><span class="p">,</span> <span class="n">PartialDependenceDisplay</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="load-data-and-build-descriptors">
<h3>1.2 Load data and build descriptors<a class="headerlink" href="#load-data-and-build-descriptors" title="Permalink to this heading">#</a></h3>
<div class="admonition-data-source admonition">
<p class="admonition-title">Data source</p>
<p>We will use this C-H oxidation dataset we saw before:<br />
<code class="docutils literal notranslate"><span class="pre">https://raw.githubusercontent.com/zzhenglab/ai4chem/main/book/_data/C_H_oxidation_dataset.csv</span></code></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/zzhenglab/ai4chem/main/book/_data/C_H_oxidation_dataset.csv&quot;</span>
<span class="n">df_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calc_descriptors_row</span><span class="p">(</span><span class="n">smiles</span><span class="p">):</span>
  <span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;MolWt&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;LogP&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;TPSA&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;NumRings&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">})</span>
  <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span>
            <span class="s2">&quot;MolWt&quot;</span><span class="p">:</span> <span class="n">Descriptors</span><span class="o">.</span><span class="n">MolWt</span><span class="p">(</span><span class="n">m</span><span class="p">),</span>
            <span class="s2">&quot;LogP&quot;</span><span class="p">:</span> <span class="n">Crippen</span><span class="o">.</span><span class="n">MolLogP</span><span class="p">(</span><span class="n">m</span><span class="p">),</span>
            <span class="s2">&quot;TPSA&quot;</span><span class="p">:</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">CalcTPSA</span><span class="p">(</span><span class="n">m</span><span class="p">),</span>
            <span class="s2">&quot;NumRings&quot;</span><span class="p">:</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">CalcNumRings</span><span class="p">(</span><span class="n">m</span><span class="p">),</span>
        <span class="p">})</span>


<span class="n">desc_df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="s2">&quot;SMILES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calc_descriptors_row</span><span class="p">)</span>
<span class="n">df_reg_mp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_raw</span><span class="p">,</span> <span class="n">desc_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_reg_mp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Compound Name</th>
      <th>CAS</th>
      <th>SMILES</th>
      <th>Solubility_mol_per_L</th>
      <th>pKa</th>
      <th>Toxicity</th>
      <th>Melting Point</th>
      <th>Reactivity</th>
      <th>Oxidation Site</th>
      <th>MolWt</th>
      <th>LogP</th>
      <th>TPSA</th>
      <th>NumRings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3,4-dihydro-1H-isochromene</td>
      <td>493-05-0</td>
      <td>c1ccc2c(c1)CCOC2</td>
      <td>0.103906</td>
      <td>5.80</td>
      <td>non_toxic</td>
      <td>65.8</td>
      <td>1</td>
      <td>8,10</td>
      <td>134.178</td>
      <td>1.7593</td>
      <td>9.23</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9H-fluorene</td>
      <td>86-73-7</td>
      <td>c1ccc2c(c1)Cc1ccccc1-2</td>
      <td>0.010460</td>
      <td>5.82</td>
      <td>toxic</td>
      <td>90.0</td>
      <td>1</td>
      <td>7</td>
      <td>166.223</td>
      <td>3.2578</td>
      <td>0.00</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1,2,3,4-tetrahydronaphthalene</td>
      <td>119-64-2</td>
      <td>c1ccc2c(c1)CCCC2</td>
      <td>0.020589</td>
      <td>5.74</td>
      <td>toxic</td>
      <td>69.4</td>
      <td>1</td>
      <td>7,10</td>
      <td>132.206</td>
      <td>2.5654</td>
      <td>0.00</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ethylbenzene</td>
      <td>100-41-4</td>
      <td>CCc1ccccc1</td>
      <td>0.048107</td>
      <td>5.87</td>
      <td>non_toxic</td>
      <td>65.0</td>
      <td>1</td>
      <td>1,2</td>
      <td>106.168</td>
      <td>2.2490</td>
      <td>0.00</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>cyclohexene</td>
      <td>110-83-8</td>
      <td>C1=CCCCC1</td>
      <td>0.060688</td>
      <td>5.66</td>
      <td>non_toxic</td>
      <td>96.4</td>
      <td>1</td>
      <td>3,6</td>
      <td>82.146</td>
      <td>2.1166</td>
      <td>0.00</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-what-these-features-mean admonition">
<p class="admonition-title">What these features mean</p>
<ul class="simple">
<li><p><strong>MolWt</strong>: molecular weight (sum of atomic masses).</p></li>
<li><p><strong>LogP</strong>: hydrophobicity descriptor (octanol/water partition).</p></li>
<li><p><strong>TPSA</strong>: topological polar surface area.</p></li>
<li><p><strong>NumRings</strong>: ring count.</p></li>
</ul>
</div>
</section>
</section>
<hr class="docutils" />
<section id="quick-exploratory-data-analysis-eda">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">2. Quick Exploratory Data Analysis (EDA)</a><a class="headerlink" href="#quick-exploratory-data-analysis-eda" title="Permalink to this heading">#</a></h2>
<section id="descriptor-histograms">
<h3>2.1 Descriptor histograms<a class="headerlink" href="#descriptor-histograms" title="Permalink to this heading">#</a></h3>
<div class="admonition-goal admonition">
<p class="admonition-title">Goal</p>
<p>Check scale, spread, and any extreme values. If a feature is highly skewed, consider transforms or standardization before training.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MolWt&quot;</span><span class="p">,</span> <span class="s2">&quot;LogP&quot;</span><span class="p">,</span> <span class="s2">&quot;TPSA&quot;</span><span class="p">,</span> <span class="s2">&quot;NumRings&quot;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/70bac9bbf86db3ce7365a60aff643d891d06066986672b0cc83c7b148641570a.png" src="_images/70bac9bbf86db3ce7365a60aff643d891d06066986672b0cc83c7b148641570a.png" />
</div>
</div>
</section>
<section id="pairwise-relationships">
<h3>2.2 Pairwise relationships<a class="headerlink" href="#pairwise-relationships" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">df_reg_mp</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Descriptor scatter matrix&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0c75ff935a88500bd148d1e5c5973c3e38007c4e7d639d8cb15fb96b017bc036.png" src="_images/0c75ff935a88500bd148d1e5c5973c3e38007c4e7d639d8cb15fb96b017bc036.png" />
</div>
</div>
<p>As you see above, a pairwise plot (also called a scatterplot matrix) shows relationships between every possible pair of features. For example, if you have four descriptors — MolWt, LogP, TPSA, and NumRings — the matrix will draw 12 scatterplots pairs (diagonal being their own distribution).</p>
<p>Why we look at pairwise plots?</p>
<p><strong>Spot correlations</strong>: If two descriptors are strongly correlated (for example, heavier molecules often have higher logP), you can see it visually.  Highly correlated pairs may be redundant.</p>
<p><strong>Detect outliers</strong>: Points that are far away from the general cloud of data stand out.</p>
</section>
<section id="redundancy-demo-and-correlation">
<h3>2.3 Redundancy demo and correlation<a class="headerlink" href="#redundancy-demo-and-correlation" title="Permalink to this heading">#</a></h3>
<p>To illustrate what redundancy looks like, in the following example, we added a synthetic feature called <code class="docutils literal notranslate"><span class="pre">MolWt_half</span></code>, created simply by multiplying molecular weight by 0.5. In the scatter matrix, <code class="docutils literal notranslate"><span class="pre">MolWt_half</span></code> and <code class="docutils literal notranslate"><span class="pre">MolW</span></code> form a perfect straight-line relationship, highlighting redundancy.</p>
<p>In real-world datasets, you might encounter similar situations where two measured properties track one another closely because they arise from the same underlying physical or chemical trend. In such cases, redundancy reduces the effective dimensionality of the dataset.</p>
<p>This visual impression can be confirmed by calculating the correlation coefficient numerically. A correlation near <code class="docutils literal notranslate"><span class="pre">1.0</span></code> (or <code class="docutils literal notranslate"><span class="pre">–1.0</span></code>) indicates strong redundancy, just like we see between MolWt and MolWt_half.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add demo redundant feature</span>
<span class="n">df_reg_mp</span><span class="p">[</span><span class="s2">&quot;MolWt_half&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="p">[</span><span class="s2">&quot;MolWt&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span>

<span class="c1"># Choose features to visualize</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MolWt&quot;</span><span class="p">,</span> <span class="s2">&quot;LogP&quot;</span><span class="p">,</span> <span class="s2">&quot;TPSA&quot;</span><span class="p">,</span> <span class="s2">&quot;NumRings&quot;</span><span class="p">,</span> <span class="s2">&quot;MolWt_half&quot;</span><span class="p">]</span>

<span class="c1"># Numerical correlation matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Correlation Matrix (rounded to 3 decimals):&quot;</span><span class="p">)</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">)</span>

<span class="c1"># Scatter matrix</span>
<span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">df_reg_mp</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">diagonal</span><span class="o">=</span><span class="s2">&quot;hist&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Descriptor Scatter Matrix&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correlation Matrix (rounded to 3 decimals):
            MolWt   LogP   TPSA  NumRings  MolWt_half
MolWt       1.000  0.595  0.447     0.759       1.000
LogP        0.595  1.000 -0.268     0.605       0.595
TPSA        0.447 -0.268  1.000     0.294       0.447
NumRings    0.759  0.605  0.294     1.000       0.759
MolWt_half  1.000  0.595  0.447     0.759       1.000
</pre></div>
</div>
<img alt="_images/fde045dec64228e243795ccfde1dc23022c64e98ed35fb8545ca1bfd37c09bb1.png" src="_images/fde045dec64228e243795ccfde1dc23022c64e98ed35fb8545ca1bfd37c09bb1.png" />
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="introduction-to-hyperparameters">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">3. Introduction to hyperparameters</a><a class="headerlink" href="#introduction-to-hyperparameters" title="Permalink to this heading">#</a></h2>
<div class="admonition-lasso-refresher admonition">
<p class="admonition-title">Lasso refresher</p>
<p>Lasso solves a linear regression with an L1 penalty. The loss (on a dataset of size <em>n</em>) is<br />
[
\frac{1}{n}\sum_{i=1}^n (y_i - \hat{y}_i)^2 + \alpha \sum_j |w_j|
]<br />
When (\alpha) is larger, more coefficients go to zero.</p>
</div>
<section id="single-split-evaluation">
<h3>3.1 Single split evaluation<a class="headerlink" href="#single-split-evaluation" title="Permalink to this heading">#</a></h3>
<p>When we fit a model, we often think about weights (w) that are learned from the data. But some knobs are not learned automatically — they are chosen by us. These are called <strong>hyperparameters</strong>. One of the most important hyperparameters in Lasso is alpha. As you may recall from last lecture, it controls the strength of the L1 penalty.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define X (features) and y (target)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="p">[[</span><span class="s2">&quot;MolWt&quot;</span><span class="p">,</span> <span class="s2">&quot;LogP&quot;</span><span class="p">,</span> <span class="s2">&quot;TPSA&quot;</span><span class="p">,</span> <span class="s2">&quot;NumRings&quot;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="p">[</span><span class="s2">&quot;Melting Point&quot;</span><span class="p">]</span>

<span class="c1"># Split into train (80%) and test (20%) sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># Define models in a dictionary</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Linear Regression&quot;</span><span class="p">:</span> <span class="n">LinearRegression</span><span class="p">(),</span>
    <span class="s2">&quot;Lasso (alpha=0.1)&quot;</span><span class="p">:</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
    <span class="s2">&quot;Lasso (alpha=1)&quot;</span><span class="p">:</span>   <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>   <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
    <span class="s2">&quot;Lasso (alpha=10)&quot;</span><span class="p">:</span>  <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
    <span class="s2">&quot;Lasso (alpha=100)&quot;</span><span class="p">:</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
    <span class="s2">&quot;Lasso (alpha=500)&quot;</span><span class="p">:</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Collect results</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="n">mse_val</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">mae_val</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">r2_val</span>  <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">mse_val</span><span class="p">,</span> <span class="n">mae_val</span><span class="p">,</span> <span class="n">r2_val</span><span class="p">])</span>

<span class="c1"># Put results in a nice DataFrame</span>
<span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="s2">&quot;MSE&quot;</span><span class="p">,</span> <span class="s2">&quot;MAE&quot;</span><span class="p">,</span> <span class="s2">&quot;R2&quot;</span><span class="p">])</span>
<span class="n">df_results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model</th>
      <th>MSE</th>
      <th>MAE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Linear Regression</td>
      <td>398.206541</td>
      <td>16.006228</td>
      <td>0.816101</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Lasso (alpha=0.1)</td>
      <td>396.546775</td>
      <td>15.975604</td>
      <td>0.816868</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lasso (alpha=1)</td>
      <td>389.603474</td>
      <td>15.816549</td>
      <td>0.820074</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Lasso (alpha=10)</td>
      <td>390.347484</td>
      <td>15.855184</td>
      <td>0.819731</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Lasso (alpha=100)</td>
      <td>399.273984</td>
      <td>16.080242</td>
      <td>0.815608</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Lasso (alpha=500)</td>
      <td>423.683879</td>
      <td>16.757040</td>
      <td>0.804335</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="effect-of-alpha-plot">
<h3>3.2 Effect of alpha (plot)<a class="headerlink" href="#effect-of-alpha-plot" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract results for plotting</span>
<span class="n">lasso_results</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="n">df_results</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Lasso&quot;</span><span class="p">)]</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="n">r2_scores</span> <span class="o">=</span> <span class="n">lasso_results</span><span class="p">[</span><span class="s2">&quot;R2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Linear Regression baseline</span>
<span class="n">linear_r2</span> <span class="o">=</span> <span class="n">df_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_results</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Linear Regression&quot;</span><span class="p">,</span> <span class="s2">&quot;R2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Plot R² vs alpha</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">r2_scores</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Lasso R²&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">linear_r2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Linear Regression R² = </span><span class="si">{</span><span class="n">linear_r2</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Alpha (log scale)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;R² Score&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Effect of Alpha on Lasso Performance&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/440bfd01eefbdd8888e779e4fdbaf7558045e55b90e4877f777b313b3ba448c5.png" src="_images/440bfd01eefbdd8888e779e4fdbaf7558045e55b90e4877f777b313b3ba448c5.png" />
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="cross-validation">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">4. Cross validation</a><a class="headerlink" href="#cross-validation" title="Permalink to this heading">#</a></h2>
<p>So far we evaluated models with a single 80/20 split, which can give performance estimates that depend strongly on the random split. To obtain a more reliable measure, we can use <strong>4-fold cross validation</strong>*. This way, the dataset is split into 4 equal parts, and each part is used once as the test set while the other 3 parts are used for training. The metrics are then averaged across the 4 folds.</p>
<div class="admonition-why-cv admonition">
<p class="admonition-title">Why CV?</p>
<p>A single split can overestimate or underestimate performance. K-fold CV repeats the split several times and averages the metric, giving a more stable estimate.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">kf</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;r2&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;alpha=</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">, Scores on each fold: </span><span class="si">{</span><span class="n">scores</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> mean R²=</span><span class="si">{</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>alpha=0.1, Scores on each fold: [0.80086458 0.8800675  0.85024608 0.81400961] 
 mean R²=0.83630 

alpha=1, Scores on each fold: [0.8012391  0.88025613 0.85027326 0.81361778] 
 mean R²=0.83635 

alpha=10, Scores on each fold: [0.80123962 0.88012751 0.85111665 0.81276335] 
 mean R²=0.83631 

alpha=100, Scores on each fold: [0.79943866 0.87767314 0.85590684 0.80952064] 
 mean R²=0.83563 
</pre></div>
</div>
</div>
</div>
<div class="admonition-exercise-4-1 admonition">
<p class="admonition-title">Exercise 4.1</p>
<p>Change the alphas to <code class="docutils literal notranslate"><span class="pre">[0.05,</span> <span class="pre">0.5,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">5,</span> <span class="pre">15,</span> <span class="pre">30,</span> <span class="pre">100]</span></code>.<br />
Use <strong>5-fold</strong> CV and the <code class="docutils literal notranslate"><span class="pre">neg_mean_squared_error</span></code> scorer.<br />
Print the per-fold values and the mean MSE.</p>
</div>
</section>
<hr class="docutils" />
<section id="model-selection-evaluation-and-prediction">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">5. Model selection, evaluation and prediction</a><a class="headerlink" href="#model-selection-evaluation-and-prediction" title="Permalink to this heading">#</a></h2>
<div class="admonition-plan admonition">
<p class="admonition-title">Plan</p>
<p>Pick an alpha using CV, fit on train, evaluate on held‑out test, then apply to new molecules.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">KFold</span><span class="p">,</span> <span class="n">cross_validate</span>

<span class="c1"># Define X and y again</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="p">[[</span><span class="s2">&quot;MolWt&quot;</span><span class="p">,</span> <span class="s2">&quot;LogP&quot;</span><span class="p">,</span> <span class="s2">&quot;TPSA&quot;</span><span class="p">,</span> <span class="s2">&quot;NumRings&quot;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="p">[</span><span class="s2">&quot;Melting Point&quot;</span><span class="p">]</span>

<span class="c1"># Train/test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Use 4-fold cross validation</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Same models as before</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Linear Regression&quot;</span><span class="p">:</span> <span class="n">LinearRegression</span><span class="p">(),</span>
    <span class="s2">&quot;Lasso (alpha=0.1)&quot;</span><span class="p">:</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
    <span class="s2">&quot;Lasso (alpha=1)&quot;</span><span class="p">:</span>   <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>   <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
    <span class="s2">&quot;Lasso (alpha=10)&quot;</span><span class="p">:</span>  <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
    <span class="s2">&quot;Lasso (alpha=30)&quot;</span><span class="p">:</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
    <span class="s2">&quot;Lasso (alpha=100)&quot;</span><span class="p">:</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">results_cv</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">kf</span><span class="p">,</span>
        <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">,</span> <span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">,</span> <span class="s2">&quot;neg_mean_absolute_error&quot;</span><span class="p">],</span>
        <span class="n">return_train_score</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="c1"># Compute mean and std across folds</span>
    <span class="n">mean_r2</span> <span class="o">=</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_r2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">mean_mse</span> <span class="o">=</span> <span class="o">-</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_neg_mean_squared_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">mean_mae</span> <span class="o">=</span> <span class="o">-</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_neg_mean_absolute_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">results_cv</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">mean_mse</span><span class="p">,</span> <span class="n">mean_mae</span><span class="p">,</span> <span class="n">mean_r2</span><span class="p">])</span>

<span class="c1"># Put results in a DataFrame</span>
<span class="n">df_results_cv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_cv</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="s2">&quot;MSE&quot;</span><span class="p">,</span> <span class="s2">&quot;MAE&quot;</span><span class="p">,</span> <span class="s2">&quot;R2&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_results_cv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               Model         MSE        MAE        R2
0  Linear Regression  410.132745  15.969645  0.832197
1  Lasso (alpha=0.1)  409.638038  15.958751  0.832326
2    Lasso (alpha=1)  408.902710  15.918428  0.832658
3   Lasso (alpha=10)  408.189050  15.900646  0.833132
4   Lasso (alpha=30)  408.099029  15.906188  0.833208
5  Lasso (alpha=100)  408.969334  15.961744  0.832932
</pre></div>
</div>
</div>
</div>
<p>Based on above table, you know alpha = 30 works best for this case.
Let’s assign this value to build a model, fit with data and evaluate the outcome, which can be completed within three lines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha_optimized_model</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">fitted_lasso</span> <span class="o">=</span> <span class="n">alpha_optimized_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test R² = </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">fitted_lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> when we use alpha = 30&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test R² = 0.818 when we use alpha = 30
</pre></div>
</div>
</div>
</div>
<p>R² = 0.820 tells us how good the fitting is. Note this R² is calculated based on the final hold-out test set, so it will be different from the R² one we see during the CV (0.833). The fact that they are very similar to each other is a good sign because this model has <strong>never</strong> seen any datapoint from <code class="docutils literal notranslate"><span class="pre">X_test</span></code> before but can still do a good prediction.</p>
<p>Now we can use this function to give prediction for points that are neither in train and test data set.
For example, we can predict two molecules’s melting point by listing their descriptors.</p>
<div class="admonition-predict-new-points admonition">
<p class="admonition-title">Predict new points</p>
<p>We can predict from raw descriptors, or compute descriptors from SMILES first (see example below).</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fitted_lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">100</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span>
                                  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MolWt&quot;</span><span class="p">,</span> <span class="s2">&quot;LogP&quot;</span><span class="p">,</span> <span class="s2">&quot;TPSA&quot;</span><span class="p">,</span> <span class="s2">&quot;NumRings&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([70.44917852, 95.30123863])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smiles_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;C1CCCC(C)C1&quot;</span><span class="p">,</span> <span class="s2">&quot;CCCO&quot;</span><span class="p">]</span>

<span class="c1"># Explicitly call your function for each SMILES</span>
<span class="n">desc_rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">calc_descriptors_row</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">smiles_list</span><span class="p">]</span>

<span class="c1"># Build DataFrame</span>
<span class="n">new_desc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">desc_rows</span><span class="p">)</span>
<span class="n">new_desc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MolWt</th>
      <th>LogP</th>
      <th>TPSA</th>
      <th>NumRings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>98.189</td>
      <td>2.5866</td>
      <td>0.00</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>60.096</td>
      <td>0.3887</td>
      <td>20.23</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predict</span>
<span class="n">two_new_preds</span> <span class="o">=</span> <span class="n">fitted_lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">new_desc</span><span class="p">)</span>

<span class="c1"># Show results</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;SMILES&quot;</span><span class="p">:</span> <span class="n">smiles_list</span><span class="p">,</span> <span class="s2">&quot;Prediction&quot;</span><span class="p">:</span> <span class="n">two_new_preds</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        SMILES  Prediction
0  C1CCCC(C)C1   69.345037
1         CCCO   51.000708
</pre></div>
</div>
</div>
</div>
<p>If your combine all above together, the workflow will look like:</p>
<ol class="arabic simple">
<li><p>Define features and target (<code class="docutils literal notranslate"><span class="pre">MolWt</span></code>, <code class="docutils literal notranslate"><span class="pre">LogP</span></code>, <code class="docutils literal notranslate"><span class="pre">TPSA</span></code>, <code class="docutils literal notranslate"><span class="pre">NumRings</span></code> → <code class="docutils literal notranslate"><span class="pre">Melting</span> <span class="pre">Point</span></code>).</p></li>
<li><p>Split data: 80% train, 20% test.</p></li>
<li><p>Model selection</p></li>
</ol>
<ul class="simple">
<li><p>Last lecture: fit on train directly if no hyperparameter tuning needed.</p></li>
<li><p>Lasso Regression (<strong>this lecture</strong>): use 4-fold cross-validation on train to pick best alpha, then refit on full train.</p></li>
</ul>
<ol class="arabic simple" start="4">
<li><p>Evaluate chosen model on test set for generalization.</p></li>
<li><p>Apply final model to new molecules for prediction.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="endtoend-workflow-and-grid-search">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">6. End‑to‑end workflow and grid search</a><a class="headerlink" href="#endtoend-workflow-and-grid-search" title="Permalink to this heading">#</a></h2>
<div class="admonition-two-ways-to-choose-alpha admonition">
<p class="admonition-title">Two ways to choose alpha</p>
<ul class="simple">
<li><p>Manual loop over a grid and pick the best mean CV score.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> to automate the loop, scoring, and refit.</p></li>
</ul>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1) Features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="p">[[</span><span class="s2">&quot;MolWt&quot;</span><span class="p">,</span> <span class="s2">&quot;LogP&quot;</span><span class="p">,</span> <span class="s2">&quot;TPSA&quot;</span><span class="p">,</span> <span class="s2">&quot;NumRings&quot;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="p">[</span><span class="s2">&quot;Melting Point&quot;</span><span class="p">]</span>

<span class="c1"># 2) Train/test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 3 Choose alpha using 4-fold CV on TRAIN ONLY</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>
          <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mean_r2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">r2_vals</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">kf</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;r2&quot;</span><span class="p">)</span>
    <span class="n">mean_r2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2_vals</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">best_alpha</span> <span class="o">=</span> <span class="n">alphas</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">mean_r2</span><span class="p">))]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best alpha: </span><span class="si">{</span><span class="n">best_alpha</span><span class="si">}</span><span class="s2"> (mean R² = </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">mean_r2</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># 4) Fit with best alpha on TRAIN, evaluate on TEST</span>
<span class="n">final_lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">best_alpha</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># 5) Evaluate</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">final_lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test R² = </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Optional: compare to plain Linear Regression</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Linear Regression Test R² = </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Quick plot of the selection</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">mean_r2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">best_alpha</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Alpha (log)&quot;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mean R² (4-fold on train)&quot;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Pick alpha by CV&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best alpha: 30 (mean R² = 0.833)
Test R² = 0.818
Linear Regression Test R² = 0.816
</pre></div>
</div>
<img alt="_images/6f84009bedf730546e2bfdf8eb1356407a2cdde16b1ed61f3cfe71b2b4d6c2a8.png" src="_images/6f84009bedf730546e2bfdf8eb1356407a2cdde16b1ed61f3cfe71b2b4d6c2a8.png" />
</div>
</div>
<p>The block above actually shows a <strong>manual</strong> grid search: you loop through candidate alphas, run cross-validation, collect mean R² scores, and then pick the best alpha before refitting on the training set.</p>
<p>Now, the second block below shows the <strong>same idea</strong> implemented with <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>: it <strong>automates</strong> the loop, scoring, and best-alpha selection. With <code class="docutils literal notranslate"><span class="pre">refit=True</span></code>, the best model is automatically retrained on the full training data, so you can directly use <code class="docutils literal notranslate"><span class="pre">grid.best_estimator_</span></code> for evaluation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1) Data</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="p">[[</span><span class="s2">&quot;MolWt&quot;</span><span class="p">,</span> <span class="s2">&quot;LogP&quot;</span><span class="p">,</span> <span class="s2">&quot;TPSA&quot;</span><span class="p">,</span> <span class="s2">&quot;NumRings&quot;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="p">[</span><span class="s2">&quot;Melting Point&quot;</span><span class="p">]</span>

<span class="c1"># 2) Train/test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 3a) Define model and CV</span>
<span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                        <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span>
                        <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">]}</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 3b) Grid search on TRAIN</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">lasso</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;r2&quot;</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best alpha: </span><span class="si">{</span><span class="n">grid</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (mean R^2 = </span><span class="si">{</span><span class="n">grid</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># 4) Best model (already fitted)</span>
<span class="n">final_lasso</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span>

<span class="c1"># 5) Evaluate on TEST</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">final_lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test R^2 = </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best alpha: 30 (mean R^2 = 0.833)
Test R^2 = 0.818
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5) Predict on new molecules</span>
<span class="n">smiles_three_new</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;C(F)(F)(F)CC=CCO&quot;</span><span class="p">,</span> <span class="s2">&quot;C1CCCC(COC)C1&quot;</span><span class="p">,</span> <span class="s2">&quot;CC(CBr)CCl&quot;</span><span class="p">]</span>

<span class="c1"># Compute descriptors for each SMILES</span>
<span class="n">smiles_three_new_desc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">calc_descriptors_row</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">smiles_three_new</span><span class="p">])</span>

<span class="c1"># Predict for valid rows</span>
<span class="n">smiles_three_new_preds</span> <span class="o">=</span> <span class="n">final_lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">smiles_three_new_desc</span><span class="p">)</span>

<span class="c1"># Show results</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;SMILES&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">smiles_three_new</span><span class="p">),</span> <span class="s2">&quot;Prediction&quot;</span><span class="p">:</span> <span class="n">smiles_three_new_preds</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          SMILES  Prediction
C(F)(F)(F)CC=CCO   90.429280
   C1CCCC(COC)C1   84.337454
      CC(CBr)CCl  105.456027
</pre></div>
</div>
</div>
</div>
<p>We can also plot some representative molecules in train and test set, as well as some new molecules we want to predict outside the exisiting dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pick samples</span>
<span class="n">train_idx</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<span class="n">test_idx</span>  <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span>  <span class="n">random_state</span><span class="o">=</span><span class="mi">202</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>

<span class="c1"># Train: true only</span>
<span class="n">train_smiles</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">,</span> <span class="s2">&quot;SMILES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">train_true</span>   <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">img_train</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
    <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">train_smiles</span><span class="p">],</span>
    <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subImgSize</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span>
    <span class="n">legends</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Train</span><span class="se">\n</span><span class="s2">True: </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> oC&quot;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">train_true</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Test: true and predicted</span>
<span class="n">test_smiles</span> <span class="o">=</span> <span class="n">df_reg_mp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">,</span> <span class="s2">&quot;SMILES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">test_true</span>   <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">test_pred</span>   <span class="o">=</span> <span class="n">final_lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">])</span>
<span class="n">img_test</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
    <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">test_smiles</span><span class="p">],</span>
    <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subImgSize</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span>
    <span class="n">legends</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Test</span><span class="se">\n</span><span class="s2">True: </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> oC | Pred: </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> oC&quot;</span>
             <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_true</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)]</span>
<span class="p">)</span>

<span class="c1"># New: predicted only</span>
<span class="n">smiles_new</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;C(F)(F)(F)CC=CCO&quot;</span><span class="p">,</span> <span class="s2">&quot;C1CCCC(COC)C1&quot;</span><span class="p">,</span> <span class="s2">&quot;CC(CBr)CCl&quot;</span><span class="p">]</span>
<span class="n">X_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">calc_descriptors_row</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">smiles_new</span><span class="p">])[</span><span class="n">final_lasso</span><span class="o">.</span><span class="n">feature_names_in_</span><span class="p">]</span>
<span class="n">pred_new</span> <span class="o">=</span> <span class="n">final_lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>
<span class="n">img_new</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
    <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">smiles_new</span><span class="p">],</span>
    <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subImgSize</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span>
    <span class="n">legends</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;New</span><span class="se">\n</span><span class="s2">Pred: </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> oC&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pred_new</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">img_train</span><span class="p">);</span> <span class="n">display</span><span class="p">(</span><span class="n">img_test</span><span class="p">);</span> <span class="n">display</span><span class="p">(</span><span class="n">img_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/69d9a28436c40575dd9fc064f889752fd8e7c96399f9f1f20979881130b855cf.png" src="_images/69d9a28436c40575dd9fc064f889752fd8e7c96399f9f1f20979881130b855cf.png" />
<img alt="_images/7275fca76abfbc94a83f305d668d4af215717b8368ed2681ac575f9eb741027d.png" src="_images/7275fca76abfbc94a83f305d668d4af215717b8368ed2681ac575f9eb741027d.png" />
<img alt="_images/d52bfa1727e760548526191b0747d445852631a5cf23631017494cc1267c46d5.png" src="_images/d52bfa1727e760548526191b0747d445852631a5cf23631017494cc1267c46d5.png" />
</div>
</div>
</section>
<hr class="docutils" />
<section id="explaining-the-model-with-feature-importance">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">7. Explaining the model with feature importance</a><a class="headerlink" href="#explaining-the-model-with-feature-importance" title="Permalink to this heading">#</a></h2>
<div class="admonition-two-views admonition">
<p class="admonition-title">Two views</p>
<ul class="simple">
<li><p><strong>Coefficients</strong>: direction and weight (Lasso shrinks some to zero).</p></li>
<li><p><strong>Permutation importance</strong>: how much test R² drops when a feature is shuffled.</p></li>
</ul>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Coefficient-based importance (Lasso) ---</span>
<span class="n">coef_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
    <span class="n">final_lasso</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="n">final_lasso</span><span class="o">.</span><span class="n">feature_names_in_</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">abs</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lasso coefficients (feature importance):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coef_importance</span><span class="p">)</span>

<span class="c1"># Plot coefficients</span>
<span class="n">coef_importance</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Feature Importance from Lasso Coefficients&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Coefficient Value&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># --- Permutation importance (model agnostic) ---</span>
<span class="n">perm_importance</span> <span class="o">=</span> <span class="n">permutation_importance</span><span class="p">(</span>
    <span class="n">final_lasso</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;r2&quot;</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">perm_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
    <span class="n">perm_importance</span><span class="o">.</span><span class="n">importances_mean</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="n">final_lasso</span><span class="o">.</span><span class="n">feature_names_in_</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Permutation importance (mean decrease in R²):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">perm_series</span><span class="p">)</span>

<span class="c1"># Plot permutation importance</span>
<span class="n">perm_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Permutation Importance (on Test Set)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Mean Decrease in R²&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lasso coefficients (feature importance):
MolWt       0.492808
TPSA        0.021167
LogP       -0.000000
NumRings   -0.000000
dtype: float64
</pre></div>
</div>
<img alt="_images/09305743e6d74df8e76fbb46657398090db5f9b64cc1a952ff1d9870b9ee8d71.png" src="_images/09305743e6d74df8e76fbb46657398090db5f9b64cc1a952ff1d9870b9ee8d71.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Permutation importance (mean decrease in R²):
LogP        0.000000
NumRings    0.000000
TPSA        0.002218
MolWt       1.607811
dtype: float64
</pre></div>
</div>
<img alt="_images/48b8e62e6153e5d2404de3aca135f22a88b195cda62fad61f88b741f6c273e0a.png" src="_images/48b8e62e6153e5d2404de3aca135f22a88b195cda62fad61f88b741f6c273e0a.png" />
</div>
</div>
</section>
<hr class="docutils" />
<section id="glossary">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">8. Glossary</a><a class="headerlink" href="#glossary" title="Permalink to this heading">#</a></h2>
<dl class="simple glossary">
<dt id="term-Lasso-Regression">Lasso Regression<a class="headerlink" href="#term-Lasso-Regression" title="Permalink to this term">#</a></dt><dd><p>Linear regression with L1 regularization that can set some coefficients to exactly zero (feature selection).</p>
</dd>
<dt id="term-Alpha">Alpha (λ)<a class="headerlink" href="#term-Alpha" title="Permalink to this term">#</a></dt><dd><p>Penalty strength in Lasso. Larger alpha increases regularization and may reduce the number of active features.</p>
</dd>
<dt id="term-Cross-validation-CV">Cross validation (CV)<a class="headerlink" href="#term-Cross-validation-CV" title="Permalink to this term">#</a></dt><dd><p>Split the data into folds, train on k‑1 folds and validate on the held‑out fold; repeat and average.</p>
</dd>
<dt id="term-R2-coefficient-of-determination">R² (coefficient of determination)<a class="headerlink" href="#term-R2-coefficient-of-determination" title="Permalink to this term">#</a></dt><dd><p>Measures how much variance the model explains. 1 is perfect, 0 matches the mean predictor.</p>
</dd>
<dt id="term-MSE">MSE<a class="headerlink" href="#term-MSE" title="Permalink to this term">#</a></dt><dd><p>Mean of squared errors. Sensitive to large errors.</p>
</dd>
<dt id="term-MAE">MAE<a class="headerlink" href="#term-MAE" title="Permalink to this term">#</a></dt><dd><p>Mean of absolute errors. More robust to outliers than MSE.</p>
</dd>
<dt id="term-Permutation-importance">Permutation importance<a class="headerlink" href="#term-Permutation-importance" title="Permalink to this term">#</a></dt><dd><p>Test‑time feature shuffle to estimate performance drop for each feature.</p>
</dd>
<dt id="term-Coefficient-importance">Coefficient importance<a class="headerlink" href="#term-Coefficient-importance" title="Permalink to this term">#</a></dt><dd><p>Weights in a linear model. In Lasso, many are shrunk to 0.</p>
</dd>
<dt id="term-Feature-redundancy">Feature redundancy<a class="headerlink" href="#term-Feature-redundancy" title="Permalink to this term">#</a></dt><dd><p>Two or more features carry nearly the same information (high correlation).</p>
</dd>
<dt id="term-GridSearchCV">GridSearchCV<a class="headerlink" href="#term-GridSearchCV" title="Permalink to this term">#</a></dt><dd><p>Scikit‑learn tool that evaluates parameter grids with CV and returns the best estimator.</p>
</dd>
</dl>
</section>
<hr class="docutils" />
<section id="quick-reference">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">9. Quick reference</a><a class="headerlink" href="#quick-reference" title="Permalink to this heading">#</a></h2>
<div class="admonition-common-scikitlearn-patterns admonition">
<p class="admonition-title">Common scikit‑learn patterns</p>
<ul class="simple">
<li><p>Split: <code class="docutils literal notranslate"><span class="pre">train_test_split(X,</span> <span class="pre">y,</span> <span class="pre">test_size=0.2,</span> <span class="pre">random_state=...)</span></code></p></li>
<li><p>CV: <code class="docutils literal notranslate"><span class="pre">KFold(n_splits=4,</span> <span class="pre">shuffle=True,</span> <span class="pre">random_state=...)</span></code></p></li>
<li><p>Score: <code class="docutils literal notranslate"><span class="pre">cross_val_score(model,</span> <span class="pre">X,</span> <span class="pre">y,</span> <span class="pre">cv=kf,</span> <span class="pre">scoring=&quot;r2&quot;)</span></code></p></li>
<li><p>Grid search: <code class="docutils literal notranslate"><span class="pre">GridSearchCV(model,</span> <span class="pre">{&quot;alpha&quot;:[...]},</span> <span class="pre">cv=kf,</span> <span class="pre">scoring=&quot;r2&quot;,</span> <span class="pre">refit=True)</span></code></p></li>
<li><p>Metrics: <code class="docutils literal notranslate"><span class="pre">mean_squared_error</span></code>, <code class="docutils literal notranslate"><span class="pre">mean_absolute_error</span></code>, <code class="docutils literal notranslate"><span class="pre">r2_score</span></code></p></li>
</ul>
</div>
<div class="admonition-diagnostic-plots admonition">
<p class="admonition-title">Diagnostic plots</p>
<ul class="simple">
<li><p><strong>Parity</strong>: predicted vs true (should hug the diagonal).</p></li>
<li><p><strong>Residuals</strong>: residual vs prediction (should center near 0 without pattern).</p></li>
<li><p><strong>CV curve</strong>: metric vs hyperparameter; pick the stable peak.</p></li>
</ul>
</div>
</section>
<hr class="docutils" />
<section id="inclass-activity">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">10. In‑class activity</a><a class="headerlink" href="#inclass-activity" title="Permalink to this heading">#</a></h2>
<p>Each task uses the functions and concepts above. Fill in the <code class="docutils literal notranslate"><span class="pre">...</span></code> lines.</p>
<section id="q1-prepare-logsolubility-and-visualize">
<h3>Q1. Prepare log‑solubility and visualize<a class="headerlink" href="#q1-prepare-logsolubility-and-visualize" title="Permalink to this heading">#</a></h3>
<p>Prepare log-solubility, split 80/20 (seed=15), and visualize.</p>
<ol class="arabic simple">
<li><p>Create <code class="docutils literal notranslate"><span class="pre">y_log·</span> <span class="pre">=</span> <span class="pre">log10(Solubility_mol_per_L</span> <span class="pre">+</span> <span class="pre">1e-6)</span></code>,</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">=</span> <span class="pre">[MolWt,</span> <span class="pre">LogP,</span> <span class="pre">TPSA,</span> <span class="pre">NumRings]</span></code>,</p></li>
<li><p>Split 80/20 with <code class="docutils literal notranslate"><span class="pre">random_state=15</span></code>,</p></li>
<li><p>Plot a histogram of <code class="docutils literal notranslate"><span class="pre">y_log</span></code>, then a pairwise scatter matrix of the four descriptors.</p></li>
</ol>
<p>Hint: After spliting, keep t</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># TO DO</span>
<span class="c1"># y_log = ...</span>
<span class="c1"># X = ...</span>
<span class="c1"># X_train, X_test, y_train, y_test = train_test_split(X, y_log, test_size=0.2, random_state=15)</span>

<span class="c1"># Plots</span>
<span class="c1"># ...</span>
</pre></div>
</div>
</section>
<section id="q2-tune-ridge-on-the-training-split">
<h3>Q2. Tune Ridge on the training split<a class="headerlink" href="#q2-tune-ridge-on-the-training-split" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Search alphas on <code class="docutils literal notranslate"><span class="pre">np.logspace(-2,</span> <span class="pre">3,</span> <span class="pre">12)</span></code> using <strong>5‑fold</strong> CV on <code class="docutils literal notranslate"><span class="pre">(X_tr,</span> <span class="pre">y_tr)</span></code></p></li>
<li><p>Report best alpha and mean CV R², then refit <code class="docutils literal notranslate"><span class="pre">Ridge(alpha=best)</span></code> on train</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># TO DO</span>
<span class="c1"># cv = KFold(n_splits=..., shuffle=..., random_state=...)</span>
<span class="c1"># alphas = ...</span>
<span class="c1"># ...</span>
<span class="c1"># ...</span>
<span class="c1"># ridge_best = Ridge(alpha=...).fit(..., ...)</span>
<span class="c1"># print(f&quot;best alpha={...:.4f}  CV mean R2={max(...):.3f}&quot;)</span>
</pre></div>
</div>
</section>
<section id="q3-evaluate-ridge-on-test-and-draw-diagnostics">
<h3>Q3. Evaluate Ridge on test and draw diagnostics<a class="headerlink" href="#q3-evaluate-ridge-on-test-and-draw-diagnostics" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Compute <strong>MSE</strong>, <strong>MAE</strong>, <strong>R²</strong> on <code class="docutils literal notranslate"><span class="pre">(X_te,</span> <span class="pre">y_te)</span></code></p></li>
<li><p>Plot a parity plot and a residual plot</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># TO DO</span>
<span class="c1"># y_hat = ...</span>
<span class="c1"># print(f&quot;Test MSE={...:.4f}  MAE={...:.4f}  R2={...:.3f}&quot;)</span>
<span class="c1"># Parity and residual plots</span>
<span class="c1"># ...</span>
</pre></div>
</div>
</section>
<section id="q4-predict-two-new-molecules-ridge">
<h3>Q4. Predict two new molecules (Ridge)<a class="headerlink" href="#q4-predict-two-new-molecules-ridge" title="Permalink to this heading">#</a></h3>
<p>Use the trained Ridge to predict log‑solubility for:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[135.0,</span> <span class="pre">2.0,</span> <span class="pre">9.2,</span> <span class="pre">2]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[301.0,</span> <span class="pre">0.5,</span> <span class="pre">17.7,</span> <span class="pre">2]</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># TO DO</span>
<span class="c1"># X_new = np.array([[135.0, 2.0, 9.2, 2],</span>
<span class="c1">#                   [301.0, 0.5, 17.7, 2]])</span>
<span class="c1"># y_new = ridge_best.predict(X_new)</span>
<span class="c1"># print(pd.DataFrame({&quot;MolWt&quot;: X_new[:,0], &quot;LogP&quot;: X_new[:,1], &quot;TPSA&quot;: X_new[:,2], &quot;NumRings&quot;: X_new[:,3],</span>
<span class="c1">#                     &quot;Predicted log10(solubility)&quot;: y_new}))</span>
</pre></div>
</div>
</section>
<section id="q5-interpret-ridge-with-coefficients-and-permutation-importance">
<h3>Q5. Interpret Ridge with coefficients and permutation importance<a class="headerlink" href="#q5-interpret-ridge-with-coefficients-and-permutation-importance" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Show coefficient magnitudes and signs</p></li>
<li><p>Compute permutation importance on the <strong>test</strong> split and plot</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># TO DO</span>
<span class="c1"># feat = [&quot;MolWt&quot;,&quot;LogP&quot;,&quot;TPSA&quot;,&quot;NumRings&quot;]</span>
<span class="c1"># coef_ser = ...</span>
<span class="c1"># coef_ser.plot(kind=&quot;barh&quot;); ...</span>

<span class="c1"># perm = permutation_importance(...)</span>
<span class="c1"># perm_ser = ...</span>
<span class="c1"># perm_ser.plot(kind=&quot;barh&quot;); ...</span>
</pre></div>
</div>
<hr class="docutils" />
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-and-setup">1. Dataset and setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-environment">1.1 Imports and environment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data-and-build-descriptors">1.2 Load data and build descriptors</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-exploratory-data-analysis-eda">2. Quick Exploratory Data Analysis (EDA)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptor-histograms">2.1 Descriptor histograms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pairwise-relationships">2.2 Pairwise relationships</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#redundancy-demo-and-correlation">2.3 Redundancy demo and correlation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-hyperparameters">3. Introduction to hyperparameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-split-evaluation">3.1 Single split evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-of-alpha-plot">3.2 Effect of alpha (plot)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-validation">4. Cross validation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection-evaluation-and-prediction">5. Model selection, evaluation and prediction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#endtoend-workflow-and-grid-search">6. End‑to‑end workflow and grid search</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#explaining-the-model-with-feature-importance">7. Explaining the model with feature importance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glossary">8. Glossary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-reference">9. Quick reference</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inclass-activity">10. In‑class activity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#q1-prepare-logsolubility-and-visualize">Q1. Prepare log‑solubility and visualize</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#q2-tune-ridge-on-the-training-split">Q2. Tune Ridge on the training split</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#q3-evaluate-ridge-on-test-and-draw-diagnostics">Q3. Evaluate Ridge on test and draw diagnostics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#q4-predict-two-new-molecules-ridge">Q4. Predict two new molecules (Ridge)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#q5-interpret-ridge-with-coefficients-and-permutation-importance">Q5. Interpret Ridge with coefficients and permutation importance</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>